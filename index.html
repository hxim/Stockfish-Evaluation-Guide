<!DOCTYPE html>
<html><head>
    <meta charset="UTF-8">
    <title>Stockfish Evaluation Guide</title>
    <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAM1BMVEVHcEwAAACJiYnv7+9CQkLe3t54eHhUVFRmZmarq6sICAj///8wMDCampocHBy8vLzNzc24bsB5AAAAAXRSTlMAQObYZgAAAG1JREFUeF5lj1kKAzEMQyPZ2We7/2nr1K0JzPsxegiMUkpzI0V+SJ5ixvOtWIzHzMongMoK0EUGNNs9/g0CMp0QLe9CBgClhJhSLhjFhdPbABhiIRd0F8JoSG29lwEc4uLGl8HfvClqKb6+5n8AQhEH6io/X30AAAAASUVORK5CYII=" rel="shortcut icon">
    <style>
        @media screen {
            .graph
            {
                background-image: radial-gradient(ellipse farthest-corner at center, #5a5a5a 0%, #262626 100%);
                color: #ffffff;
                font-size: 11px;
                line-height: 17px;
                position: relative;
                display: inline-block;
                padding: 10px 10px 40px 10px;
            }
            .graph .label
            {
                text-align: right;
                margin-right: 500px;
                opacity: 0.8;
                white-space: nowrap;
                height: 17px;
            }
            .graph .label:hover
            {
                text-decoration: underline;
                cursor: pointer;
            }
            .graph .line0
            {
                background-color: #ffffff;
                opacity: 0.5;
                position: absolute;
                bottom: 41px;
                top: 11px;
                right: 258px;
                width: 1px;                
            }
            .graph .line1
            {
                background-color: #ffffff;
                opacity: 0.2;
                position: absolute;
                bottom: 41px;
                top: 11px;
                width: 1px;                
            }
            .graph .xlabel
            {
                opacity: 0.8;
                position: absolute;
                bottom: 17px;
                width: 20px;
                text-align: center;
            }               
            .graph .bar
            {
                box-shadow: 0px 2px 3px 0px rgba(0,0,0,0.5);
                height: 7px;
                position: absolute;
            }
            .graph .background
            {
                border: solid 1px #ffffff;
                opacity: 0.2;
                position: absolute;
                bottom: 40px;
                top: 10px;
                right: 15px;
                width: 485px;
            }

            .graph2
            {
                background-image: radial-gradient(ellipse farthest-corner at center, #5a5a5a 0%, #262626 100%);
                color: #ffffff;
                font-size: 11px;
                line-height: 17px;
                position: relative;
                display: inline-block;
                height: 527px;
            }
            .graph2 .point
            {
                box-shadow: 0px 2px 3px 0px rgba(0,0,0,0.4);
                width: 4px;
                height: 4px;
                border: solid 1px black;
                position: absolute;
            }
            .graph2 .shadow
            {
                filter: drop-shadow( 0px 2px 3px rgba(0,0,0,0.8) );
            }

            .graph2legend
            {
                background-image: radial-gradient(ellipse farthest-corner at center, #5a5a5a 0%, #262626 100%);
            }
            .graph2legend label
            {
                border: solid 1px black;
                border-radius: 5px;
                height: 17px;
                display: inline-block;
                margin: 2px;
                padding: 2px;
                font-size: 11px;
                line-height: 25px;
            }
            .graph2legend label:hover, .graph2legend input:hover
            {
                cursor: pointer;
            }
            .graph2legend label span
            {
                top: -3px;
                position: relative;
            }
            .graph2filter
            {
                color:white;
                font-size: 11px;
                margin: 0 4px 0 4px;
                padding-bottom: 2px;
            }
            .graph2legend .graph2filter input
            {
                height: 15px;
                border: solid 1px black;
                font-size: 11px;
                cursor: text;
                width: 25px;
                padding-left: 4px;
            }
            .graph2legend .graph2filter label
            {
                line-height: 18px;
            }
            .graph2legend .graph2filter label span
            {
                position: static;
            }


            .graph2 .background
            {
                border: solid 1px #ffffff;
                opacity: 0.2;
                position: absolute;
                right: 15px;
                left: 40px;
                bottom: 30px;
                top: 10px;
            }
            .graph2 .ylabel
            {
                opacity: 0.8;
                position: absolute;
                left: 2px;
                width: 30px;
                text-align: right;
                font-size: 11px;
                line-height: 17px;
            }
            .graph2 .xlabel
            {
                opacity: 0.8;
                position: absolute;
                bottom: 7px;
                width: 34px;
                text-align: center;
                font-size: 11px;
                line-height: 17px;
            }
            .cb
            {
                position: relative;
            }
            .cb > div
            {
                position: absolute;
                width: 28px;
                height: 28px;
                background-repeat: none;
                background-position: center;
                font-weight: bold;
                line-height: 28px;
            }
            .cbTable
            {
                width: 100%;
                background: white;
                font-size: 88%;
                border: 1px #b0b0b0 solid;
                padding: 0;
                margin: auto;
            }
            .cbTable td
            {
                vertical-align: middle;
                min-width: 18px;
            }
            .cbTable td.cbCell
            {
                padding: 0;
                vertical-align: top;
                border: 1px #b0b0b0 solid;
                width: 224px;
                height: 224px;
            }
            .cb > .l { background-color: #fffffa; }
            .cb > .d { background-color: #83a5d2; }
            .cb > .h { background-image: linear-gradient(to bottom right, #666666,#000000); color: #fffffa; }
            .cb > .s { font-size: 80%; }
            .cb > .h1:before { content: ""; background-color: transparent; display: block; width: 22px; height: 22px; border: 3px solid #dd0000; border-radius:10px;}
            .cb > .h2:before { content: ""; background-color: transparent; display: block; width: 22px; height: 22px; border: 3px solid #dd00dd; border-radius:10px;}
            .cb > .h1.h2:before { content: ""; background-color: transparent; display: block; width: 22px; height: 22px; border: 3px solid #dd6600; border-radius:10px; }
            .cb > .h3:before { content: ""; background-color: transparent; display: block; width: 22px; height: 22px; border: 3px solid #00dd00; border-radius:10px;}
            .cb > .k { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg stroke-linejoin='miter'%3E%3Cpath d='m22.5 11.63v-5.63' stroke='%23000'/%3E%3Cpath d='m22.5 25c0 0 4.5-7.5 3-10.5 0 0-1-2.5-3-2.5-2 0-3 2.5-3 2.5-1.5 3 3 10.5 3 10.5' fill='%23000' stroke-linecap='butt'/%3E%3C/g%3E%3Cg stroke='%23000'%3E%3Cpath d='m11.5 37c5.5 3.5 15.5 3.5 21 0v-7c0 0 9-4.5 6-10.5-4-6.5-13.5-3.5-16 4v3.5-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10v7.5z' fill='%23000'/%3E%3Cpath d='m20 8h5' stroke-linejoin='miter'/%3E%3C/g%3E%3Cg stroke='%23ececec'%3E%3Cpath d='m32 29.5c0 0 8.5-4 6.03-9.65-3.88-5.85-13.03-1.85-15.53 4.65l.01 2.1-.01-2.1c-2.5-6.5-12.594-10.5-15.503-4.65-2.497 5.65 4.853 9 4.853 9'/%3E%3Cpath d='m11.5 30c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0m-21 3.5c5.5-3 15.5-3 21 0'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .q { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg stroke='none'%3E%3Ccircle cx='6' cy='12' r='2.75'/%3E%3Ccircle cx='14' cy='9' r='2.75'/%3E%3Ccircle cx='22.5' cy='8' r='2.75'/%3E%3Ccircle cx='31' cy='9' r='2.75'/%3E%3Ccircle cx='39' cy='12' r='2.75'/%3E%3C/g%3E%3Cg stroke-linecap='butt'%3E%3Cpath d='m9 26c8.5-1.5 21-1.5 27 0l2.5-12.5-7.5 11.5-.3-14.1-5.2 13.6-3-14.5-3 14.5-5.2-13.6-.3 14.1-7.5-11.5 2.5 12.5z' stroke='%23000'/%3E%3Cpath d='m9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z'/%3E%3Cpath d='M11 38.5A35 35 1 0 0 34 38.5' fill='none' stroke='%23000'/%3E%3C/g%3E%3Cg fill='none' stroke='%23ececec'%3E%3Cpath d='M11 29A35 35 1 0 1 34 29'/%3E%3Cpath d='m12.5 31.5h20'/%3E%3Cpath d='M11.5 34.5A35 35 1 0 0 33.5 34.5'/%3E%3Cpath d='M10.5 37.5A35 35 1 0 0 34.5 37.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .r { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg stroke-linecap='butt'%3E%3Cpath d='m9 39h27v-3h-27v3z'/%3E%3Cpath d='m12.5 32l1.5-2.5h17l1.5 2.5h-20z'/%3E%3Cpath d='m12 36v-4h21v4h-21z'/%3E%3Cpath d='m14 29.5v-13h17v13h-17z' stroke-linejoin='miter'/%3E%3Cpath d='m14 16.5l-3-2.5h23l-3 2.5h-17z'/%3E%3Cpath d='m11 14v-5h4v2h5v-2h5v2h5v-2h4v5h-23z'/%3E%3C/g%3E%3Cg fill='none' stroke='%23ececec' stroke-linejoin='miter' stroke-width='1'%3E%3Cpath d='m12 35.5h21'/%3E%3Cpath d='m13 31.5h19'/%3E%3Cpath d='m14 29.5h17'/%3E%3Cpath d='m14 16.5h17'/%3E%3Cpath d='m11 14h23'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .b { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg fill='%23000' stroke='%23000' stroke-linecap='butt'%3E%3Cpath d='m9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2z'/%3E%3Cpath d='m15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z'/%3E%3Cpath d='M25 8A2.5 2.5 0 1 1 20 8 2.5 2.5 0 1 1 25 8z'/%3E%3C/g%3E%3Cpath d='m17.5 26h10m-12.5 4h15m-7.5-14.5v5m-2.5-2.5h5' stroke='%23ececec' stroke-linejoin='miter'/%3E%3C/g%3E%3C/svg%3E");}
            .cb > .n { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg fill='%23000' stroke='%23000'%3E%3Cpath d='m22 10c10.5 1 16.5 8 16 29h-23c0-9 10-6.5 8-21'/%3E%3Cpath d='m24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4 1-4-4 0-2 6-12 6-12 0 0 1.89-1.9 2-3.5-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2c0 0 .78-1.992 2.5-3 1 0 1 3 1 3'/%3E%3C/g%3E%3Cg fill='%23ececec'%3E%3Cg stroke='%23ececec'%3E%3Cpath d='M9.5 25.5A.5 .5 0 1 1 8.5 25.5 .5 .5 0 1 1 9.5 25.5z'/%3E%3Cpath d='M15 15.5A.5 1.5 0 1 1 14 15.5 .5 1.5 0 1 1 15 15.5z' transform='matrix(.866.5-.5.866 9.693-5.173)'/%3E%3C/g%3E%3Cpath d='m24.55 10.4l-.45 1.45.5.15c3.15 1 5.65 2.49 7.9 6.75 2.25 4.26 3.25 10.31 2.75 20.25l-.05.5h2.25l.05-.5c.5-10.06-.88-16.85-3.25-21.34-2.37-4.49-5.79-6.64-9.19-7.16l-.51-.1' stroke='none'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .p { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cpath d='m22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z' stroke='%23000' stroke-linecap='round' stroke-width='1.5'/%3E%3C/svg%3E");}
            .cb > .K { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg stroke-linejoin='miter'%3E%3Cpath d='m22.5 11.63v-5.63'/%3E%3Cpath d='m20 8h5'/%3E%3Cpath d='m22.5 25c0 0 4.5-7.5 3-10.5 0 0-1-2.5-3-2.5-2 0-3 2.5-3 2.5-1.5 3 3 10.5 3 10.5' fill='%23fff' stroke-linecap='butt'/%3E%3C/g%3E%3Cpath d='m11.5 37c5.5 3.5 15.5 3.5 21 0v-7c0 0 9-4.5 6-10.5-4-6.5-13.5-3.5-16 4v3.5-3.5c-3.5-7.5-13-10.5-16-4-3 6 5 10 5 10v7.5z' fill='%23fff'/%3E%3Cpath d='m11.5 30c5.5-3 15.5-3 21 0'/%3E%3Cpath d='m11.5 33.5c5.5-3 15.5-3 21 0'/%3E%3Cpath d='m11.5 37c5.5-3 15.5-3 21 0'/%3E%3C/g%3E%3C/svg%3E");}
            .cb > .Q { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath id='0' d='M9 13A2 2 0 1 1 5 13 2 2 0 1 1 9 13z'/%3E%3C/defs%3E%3Cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cuse transform='translate(-1-1)' xlink:href='%230'/%3E%3Cuse transform='translate(15.5-5.5)' xlink:href='%230'/%3E%3Cuse transform='translate(32-1)' xlink:href='%230'/%3E%3Cuse transform='translate(7-4.5)' xlink:href='%230'/%3E%3Cuse transform='translate(24-4)' xlink:href='%230'/%3E%3Cg stroke-linecap='butt'%3E%3Cpath d='m9 26c8.5-1.5 21-1.5 27 0l2-12-7 11v-14l-5.5 13.5-3-15-3 15-5.5-14v14.5l-7-11 2 12z'/%3E%3Cpath d='m9 26c0 2 1.5 2 2.5 4 1 1.5 1 1 .5 3.5-1.5 1-1.5 2.5-1.5 2.5-1.5 1.5.5 2.5.5 2.5 6.5 1 16.5 1 23 0 0 0 1.5-1 0-2.5 0 0 .5-1.5-1-2.5-.5-2.5-.5-2 .5-3.5 1-2 2.5-2 2.5-4-8.5-1.5-18.5-1.5-27 0z'/%3E%3C/g%3E%3Cg fill='none'%3E%3Cpath d='m11.5 30c3.5-1 18.5-1 22 0'/%3E%3Cpath d='m12 33.5c6-1 15-1 21 0'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .R { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='%23fff' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg stroke-linecap='butt'%3E%3Cpath d='m9 39h27v-3h-27v3z'/%3E%3Cpath d='m12 36v-4h21v4h-21z'/%3E%3Cpath d='m11 14v-5h4v2h5v-2h5v2h5v-2h4v5'/%3E%3C/g%3E%3Cpath d='m34 14l-3 3h-17l-3-3'/%3E%3Cpath d='m31 17v12.5h-17v-12.5' stroke-linejoin='miter' stroke-linecap='butt'/%3E%3Cpath d='m31 29.5l1.5 2.5h-20l1.5-2.5'/%3E%3Cpath d='m11 14h23' fill='none' stroke='%23000' stroke-linejoin='miter'/%3E%3C/g%3E%3C/svg%3E");}
            .cb > .B { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg fill='%23fff' stroke-linecap='butt'%3E%3Cpath d='m9 36c3.39-.97 10.11.43 13.5-2 3.39 2.43 10.11 1.03 13.5 2 0 0 1.65.54 3 2-.68.97-1.65.99-3 .5-3.39-.97-10.11.46-13.5-1-3.39 1.46-10.11.03-13.5 1-1.354.49-2.323.47-3-.5 1.354-1.94 3-2 3-2z'/%3E%3Cpath d='m15 32c2.5 2.5 12.5 2.5 15 0 .5-1.5 0-2 0-2 0-2.5-2.5-4-2.5-4 5.5-1.5 6-11.5-5-15.5-11 4-10.5 14-5 15.5 0 0-2.5 1.5-2.5 4 0 0-.5.5 0 2z'/%3E%3Cpath d='M25 8A2.5 2.5 0 1 1 20 8 2.5 2.5 0 1 1 25 8z'/%3E%3C/g%3E%3Cpath d='m17.5 26h10m-12.5 4h15m-7.5-14.5v5m-2.5-2.5h5' stroke-linejoin='miter'/%3E%3C/g%3E%3C/svg%3E");}
            .cb > .N { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23000' stroke-linejoin='round' stroke-linecap='round' stroke-width='1.5'%3E%3Cg fill='%23fff'%3E%3Cpath d='m22 10c10.5 1 16.5 8 16 29h-23c0-9 10-6.5 8-21'/%3E%3Cpath d='m24 18c.38 2.91-5.55 7.37-8 9-3 2-2.82 4.34-5 4-1.042-.94 1.41-3.04 0-3-1 0 .19 1.23-1 2-1 0-4 1-4-4 0-2 6-12 6-12 0 0 1.89-1.9 2-3.5-.73-.994-.5-2-.5-3 1-1 3 2.5 3 2.5h2c0 0 .78-1.992 2.5-3 1 0 1 3 1 3'/%3E%3C/g%3E%3Cg fill='%23000'%3E%3Cpath d='M9.5 25.5A.5 .5 0 1 1 8.5 25.5 .5 .5 0 1 1 9.5 25.5z'/%3E%3Cpath d='M15 15.5A.5 1.5 0 1 1 14 15.5 .5 1.5 0 1 1 15 15.5z' transform='matrix(.866.5-.5.866 9.693-5.173)'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
            .cb > .P { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45 45'%3E%3Cpath d='m22 9c-2.21 0-4 1.79-4 4 0 .89.29 1.71.78 2.38-1.95 1.12-3.28 3.21-3.28 5.62 0 2.03.94 3.84 2.41 5.03-3 1.06-7.41 5.55-7.41 13.47h23c0-7.92-4.41-12.41-7.41-13.47 1.47-1.19 2.41-3 2.41-5.03 0-2.41-1.33-4.5-3.28-5.62.49-.67.78-1.49.78-2.38 0-2.21-1.79-4-4-4z' fill='%23fff' stroke='%23000' stroke-linecap='round' stroke-width='1.5'/%3E%3C/svg%3E");}

            .cTable {
                margin: 1em 0;
                background-color: #f8f9fa;
                border: 1px solid #a2a9b1;
                border-collapse: collapse;
                text-align: center;
                font-size: 90%;
            }
            .cTable tr th {
                background-color: #eaecf0;
                text-align: center;
            }
            .cTable tr th, .cTable tr td {
                border: 1px solid #a2a9b1;
                padding: 0.2em 0.4em;
            }
                        
            .contentText ul {
                margin: 0.3em 0 0 1.6em;
                padding: 0;
            }

            div.tright, div.floatright, table.floatright {
                clear: right;
                float: right;
            }

            div.tleft {
                float: left;
            }

            a {
                text-decoration: none;
                color: #0645ad;
                background: none;
            }

                a:not( [href] ) {
                    cursor: pointer;
                }

                a:visited {
                    color: #0b0080;
                }

                a:active {
                    color: #faa700;
                }

                a:hover, a:focus {
                    text-decoration: underline;
                }

            #content a.external {
                color: #36b;
            }

                #content a.external:visited {
                    color: #636;
                }

                #content a.external:active {
                    color: #b63;
                }

            img {
                border: none;
                vertical-align: middle;
            }

            hr {
                height: 1px;
                color: #aaa;
                background-color: #aaa;
                border: 0;
                margin: .2em 0;
            }

            h2, h3 {
                color: #000;
                background: none;
                font-weight: normal;
                margin: 0;
                overflow: hidden;
                padding-top: .5em;
                padding-bottom: .17em;
                border-bottom: 1px solid #aaa;
            }
            
            h2 {
                font-family: "Linux Libertine",Georgia,Times,serif;
                line-height: 1.3;
                margin-bottom: 0.25em;
                padding: 0;            
            }

            h2 {
                font-size: 1.5em;
                margin-top: 1em;
            }
            
            h3 {
                font-size: 1.2em;
                border-bottom: none;
                font-weight: bold;
            }                

            #content h3 {
                line-height: 1.6;
                margin-top: 0.3em;
                margin-bottom: 0;
                padding-bottom: 0;
            }

            p {
                margin: .4em 0 .5em 0;
            }

                p img {
                    margin: 0;
                }

            ul {
                list-style-type: square;
                margin: .3em 0 0 1.6em;
                padding: 0;
            }

            ol {
                margin: .3em 0 0 3.2em;
                padding: 0;
                list-style-image: none;
            }

            li {
                margin-bottom: .1em;
            }

            pre, code, tt, kbd, samp {
                font-family: monospace,'Courier';
            }

            pre {
                color: #000;
                background-color: #f9f9f9;
                border: 1px solid #ddd;
                padding: 1em;
                white-space: pre-wrap;
                line-height: 1.3em;
            }

            table {
                font-size: 100%;
            }

            div.thumb {
                margin-bottom: .5em;
                width: auto;
                background-color: transparent;
                position: relative;
            }
            #thumbbuttons {
                position: absolute;
                top: -22px;
                line-height: 18px;
                height: 18px;
                width: 272px;
                font-size: 12px;                
            }
            #thumbbuttons div {
                display: inline-block;
                text-align: center;
                color: #222222;
                cursor: default;
                vertical-align: center;
                line-height: 18px;
                user-select: none;
                -moz-user-select: -moz-none;
                border-radius: 2px;
                border: solid 1px #a2a9b1;
                background-color: #f8f9fa;
                margin-right: 2px;
                padding: 0 5px 0 5px;
            }
            #buttonback, #buttonforward {
                font-size: 16px;
            }
            #buttonstm {
                float: right;
                border-radius: 10px !important;
                height: 18px;
                width: 18px;
                padding: 0 !important;
                text-align: center;
            }
            #buttonstm.white, #buttonstm.white:hover {
                background-color: #ffffff !important;
            }
            #buttonstm.black, #buttonstm.black:hover {
                background-color: #000000 !important;
                color: #ffffff !important;
            }

            #thumbbuttons .off {
                color: #777777;
            }
            #thumbbuttons .on:hover {
                background-color: #ffffff;
                color: #222222;
                cursor: pointer;
            }

            div.thumbinner {
                border: 1px solid #ccc;
                padding: 3px;
                background-color: #f9f9f9;
                font-size: 94%;
                text-align: center;
                overflow: hidden;
            }

            #thumbcaption {
                border: none;
                line-height: 1.4em;
                padding: 3px;
                font-size: 94%;
                text-align: left;
            }

            div.tright {
                margin: .5em 0 1.3em 1.4em;
            }

            div.tleft {
                margin: .5em 1.4em 1.3em 0;
            }

            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
                font-family: sans-serif;
                font-size: 100%;
                background-color: #f6f6f6;
            }

            #content {
                margin-left: 10em;
                padding: 1em;
                border: 1px solid #a7d7f9;
                border-right-width: 0;
                margin-top: -1px;
                background-color: #ffffff;
                color: #252525;
            }

                #content p {
                    line-height: inherit;
                    margin: 0.5em 0;
                }

                #content #info {
                    border-bottom: 1px solid #aaa;
                }

                #content #info #fen {
                    float: right;
                    padding-left: 10px;
                    padding-right: 10px;
                    font-size: 12px;
                    line-height: 30px;
                }
                #content #info #headline {
                    font-size: 1.8em;
                    margin-top: .1em;
                    margin-bottom: 0;
                    line-height: 1.2em;
                    padding-bottom: 0;
                    background-color: #ffffff;
                    display: inline-block;
                    font-weight: normal;
                    font-family: "Linux Libertine",Georgia,Times,serif;
                }
            ul {
                list-style-type: disc;
                list-style-image: url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%225%22%20height%3D%2213%22%3E%0A%3Ccircle%20cx%3D%222.5%22%20cy%3D%229.5%22%20r%3D%222.5%22%20fill%3D%22%2300528c%22%2F%3E%0A%3C%2Fsvg%3E%0A);
            }

            #bodyContent, #bodyContentGlobal, #bodyContentTable, #bodyContentGraph {
                position: relative;
                line-height: 1.6;
                font-size: 0.875em;
                z-index: 0;
                margin-top: 1.175em;
            }

            #links {
                position: absolute;
                top: 0.33em;
                right: 0.75em;
                z-index: 100;
            }

                #links ul {
                    list-style-type: none;
                    list-style-image: none;
                    margin: 0;
                    padding-left: 10em;
                }

                #links li {
                    line-height: 1.125em;
                    float: left;
                    margin-left: 0.75em;
                    margin-top: 0.5em;
                    font-size: 0.75em;
                    white-space: nowrap;
                }

            #searchWrapper {
                float: left;
                margin-right: 0.5em;
                margin-left: 0.5em;
            }

                #searchWrapper form, #searchWrapper input {
                    margin: 0;
                    margin-top: 0.65em;
                }

            #simpleSearch {
                display: block;
                width: 12.6em;
                width: 20vw;
                min-width: 5em;
                max-width: 20em;
                padding-right: 1.4em;
                height: 1.4em;
                margin-top: 0.65em;
                position: relative;
                min-height: 1px;
                border: solid 1px #aaa;
                color: black;
                background-color: white;
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAQCAIAAABY/YLgAAAAJUlEQVQIHQXBsQEAAAjDoND/73UWdnerhmHVsDQZJrNWVg3Dqge6bgMe6bejNAAAAABJRU5ErkJggg==);
                background-position: top left;
                background-repeat: repeat-x;
            }

                #simpleSearch input {
                    margin: 0;
                    padding: 0;
                    border: 0;
                    background-color: transparent;
                    color: black;
                }

                #simpleSearch #searchInput {
                    width: 100%;
                    padding: 0.2em 0 0.2em 0.2em;
                    font-size: 13px;
                    -webkit-appearance: textfield;
                }

                    #simpleSearch #searchInput:focus {
                        outline: none;
                    }

                    #simpleSearch #searchInput.placeholder {
                        color: #999;
                    }

                    #simpleSearch #searchInput:-ms-input-placeholder {
                        color: #999;
                    }

                    #simpleSearch #searchInput:-moz-placeholder {
                        color: #999;
                    }

                    #simpleSearch #searchInput::-webkit-search-decoration, #simpleSearch #searchInput::-webkit-search-cancel-button, #simpleSearch #searchInput::-webkit-search-results-button, #simpleSearch #searchInput::-webkit-search-results-decoration {
                        -webkit-appearance: textfield;
                    }

                #simpleSearch #searchButton {
                    position: absolute;
                    top: 0;
                    right: 0;
                    width: 1.65em;
                    height: 100%;
                    cursor: pointer;
                    text-indent: -99999px;
                    line-height: 1;
                    white-space: nowrap;
                    overflow: hidden;
                }

                #simpleSearch #searchButton {
                    background-image: linear-gradient(transparent,transparent),url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2213%22%3E%3Cg%20stroke-width%3D%222%22%20stroke%3D%22%236c6c6c%22%20fill%3D%22none%22%3E%3Cpath%20d%3D%22M11.29%2011.71l-4-4%22%2F%3E%3Ccircle%20cx%3D%225%22%20cy%3D%225%22%20r%3D%224%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E);
                    background-position: center center;
                    background-repeat: no-repeat;
                }

            div.tabs {
                float: left;
                height: 2.5em;
                background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==);
                background-position: bottom left;
                background-repeat: no-repeat;
                padding-left: 1px;
            }

                div.tabs ul {
                    float: left;
                    height: 100%;
                    list-style-type: none;
                    list-style-image: none;
                    margin: 0;
                    padding: 0;
                    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==);
                    background-position: right bottom;
                    background-repeat: no-repeat;
                }

                    div.tabs ul li {
                        float: left;
                        line-height: 1.125em;
                        display: inline-block;
                        height: 100%;
                        margin: 0;
                        padding: 0;
                        background-color: #f3f3f3;
                        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkCAIAAADITs03AAAAO0lEQVR4AeSKhREAMQzDdN5/5uixuEKDpqgBjl2f78wd2DVj1+26/h///PfteVMN7zoGebcg1/Y/ZQQAlAUtQCujIJMAAAAASUVORK5CYII=);
                        background-position: bottom left;
                        background-repeat: repeat-x;
                        white-space: nowrap;
                    }

                    div.tabs ul > li {
                        display: block;
                    }

                div.tabs li {
                }

                    div.tabs li.selected {
                        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkAQAAAABvV2fNAAAADElEQVR4AWNoGB4QAInlMgFKeRKBAAAAAElFTkSuQmCC);
                    }

                        div.tabs li.selected a, div.tabs li.selected a:visited {
                            color: #333;
                            text-decoration: none;
                        }

                    div.tabs li a {
                        display: inline-block;
                        height: 1.9em;
                        padding-left: 0.5em;
                        padding-right: 0.5em;
                        color: #0645ad;
                        cursor: pointer;
                        font-size: 0.8em;
                    }

                div.tabs span {
                    display: inline-block;
                    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAuCAIAAABmjeQ9AAAAQ0lEQVR4AWVOhQEAIAzC/X+xAXbXeoDFGA3A9yk1n4juBROcUegfarWjP3ojZvEzxs6j+nygmo+zzsk79nY+tOxdEhlf3UHVgUFrVwAAAABJRU5ErkJggg==);
                    background-position: bottom right;
                    background-repeat: no-repeat;
                }

                    div.tabs span a {
                        display: inline-block;
                        padding-top: 1.25em;
                    }

                    div.tabs span > a {
                        float: left;
                        display: block;
                    }

            #header {
                height: 5em;
                background-position: bottom left;
                background-repeat: repeat-x;
                background-color: #f6f6f6;
                background-image: -webkit-gradient(linear,left top,left bottom,color-stop(50%,#ffffff),color-stop(100%,#f6f6f6));
                background-image: -webkit-linear-gradient(top,#ffffff 50%,#f6f6f6 100%);
                background-image: -moz-linear-gradient(top,#ffffff 50%,#f6f6f6 100%);
                background-image: linear-gradient(#ffffff 50%,#f6f6f6 100%);
                background-color: #ffffff;
            }

            div#head {
                position: absolute;
                top: 0;
                right: 0;
                width: 100%;
            }

            #leftNav {
                float: left;
                margin-left: 10em;
                margin-top: 2.5em;
                margin-bottom: -2.5em;
                display: inline;
            }

            #rightNav {
                float: right;
                margin-top: 2.5em;
            }

            #logo {
                position: absolute;
                top: -160px;
                left: 0;
                width: 10em;
                height: 160px;
            }

                #logo a {
                    display: block;
                    width: 10em;
                    height: 160px;
                    background-repeat: no-repeat;
                    background-position: center center;
                    text-decoration: none;
                    background-image: url('data:image/png;base64,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');
                }

            div#leftmenu {
                font-size: inherit;
                position: absolute;
                top: 160px;
                padding-top: 1em;
                width: 10em;
                left: 0;
            }

                div#leftmenu div.group {
                    margin: 0 0.6em 0 0.7em;
                    padding: 0.25em 0;
                    background-position: top left;
                    background-repeat: no-repeat;
                    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAAABCAAAAAAphRnkAAAAJ0lEQVQIW7XFsQEAIAyAMPD/b7uLWz8wS5youFW1UREfiIpH1Q2VBz7fGPS1dOGeAAAAAElFTkSuQmCC);
                }

                    div#leftmenu div.group h3 {
                        color: #0645ad;
                        font-size: 0.75em;
                        font-weight: bold;
                        margin: 0;
                        padding: 0.25em 0 0.25em 0.25em;
                        cursor: default;
                        border: none;
                    }
                    div#leftmenu div.group h3:hover {
                        text-decoration: underline;
                        cursor: pointer;
                    }
                    

                    div#leftmenu div.group div.body {
                        margin: 0 0 0 1.25em;
                        padding-top: 0;
                    }

                        div#leftmenu div.group div.body ul {
                            list-style-type: none;
                            list-style-image: none;
                            margin: 0;
                            padding: 0;
                        }

                            div#leftmenu div.group div.body ul li {
                                line-height: 1.125em;
                                margin: 0;
                                padding: 0.25em 0;
                                font-size: 0.75em;
                                word-wrap: break-word;
                            }

                                div#leftmenu div.group div.body ul li a {
                                    color: #0645ad;
                                }

                                    div#leftmenu div.group div.body ul li a:visited {
                                        color: #0b0080;
                                    }

                div#leftmenu #logo + div.group {
                    background-image: none;
                    margin-top: 0;
                }

                    div#leftmenu #logo + div.group div.body {
                        margin-left: 0.5em;
                    }

            div#footer {
                margin-left: 10em;
                margin-top: 0;
                padding: 0.75em;
                line-height: 1.4em;
            }

                div#footer ul {
                    list-style-type: none;
                    list-style-image: none;
                    margin: 0;
                    padding: 0;
                }

                    div#footer ul li {
                        margin: 0;
                        padding: 0;
                        padding-top: 0.5em;
                        padding-bottom: 0.5em;
                        color: #333;
                        font-size: 0.7em;
                    }

            #content .external {
                background-position: center right;
                background-repeat: no-repeat;
                background-image: linear-gradient(transparent,transparent),url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%20standalone%3D%22no%22%3F%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%3E%3Cpath%20fill%3D%22%23fff%22%20stroke%3D%22%2306c%22%20d%3D%22M1.5%204.518h5.982V10.5H1.5z%22%2F%3E%3Cpath%20d%3D%22M5.765%201H11v5.39L9.427%207.937l-1.31-1.31L5.393%209.35l-2.69-2.688%202.81-2.808L4.2%202.544z%22%20fill%3D%22%2306f%22%2F%3E%3Cpath%20d%3D%22M9.995%202.004l.022%204.885L8.2%205.07%205.32%207.95%204.09%206.723l2.882-2.88-1.85-1.852z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);
                padding-right: 13px;
            }
        }

        @media screen and (min-width:982px) {
            #content {
                margin-left: 11em;
                padding: 1.25em 1.5em 1.5em 1.5em;
            }

            #logo {
                left: 0.5em;
            }

            div#footer {
                margin-left: 11em;
                padding: 1.25em;
            }

            #leftmenu {
                padding-left: 0.5em;
            }

            #searchWrapper {
                margin-right: 1em;
            }

            #leftNav {
                margin-left: 11em;
            }

            #links {
                right: 1em;
            }
        }
    </style>
</head>
<body>
    <div id="header"></div>
    <div id="content">
        <div id="info" style="">
            <h1 id="headline" style=""></h1>
            <div id="fen">rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1</div>
        </div>
        <div id="bodyContent" style="">
            <div id="thumb" class="thumb tright" style="">
                <div id="thumbbuttons"><div id="buttonback" class="off" onclick="historymove(-1,event);" title="back">◄</div><div id="buttonforward" class="off" onclick="historymove(+1,event);" title="forward">►</div><div id="buttonstm" class="on white" onclick="command('sidetomove');" title="white to move">w</div></div>
                <div class="thumbinner">
                <table class="cbTable" cellspacing="0" cellpadding="0">
                <tbody><tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                <tr><td>8</td><td colspan="8" rowspan="8" class="cbCell"><div id="chessboard1" class="cb"></div></td><td>8</td></tr>
                <tr><td>7</td><td>7</td></tr><tr><td>6</td><td>6</td></tr><tr><td>5</td><td>5</td></tr><tr><td>4</td><td>4</td></tr>
                <tr><td>3</td><td>3</td></tr><tr><td>2</td><td>2</td></tr><tr><td>1</td><td>1</td></tr>
                <tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                </tbody></table>
                <div id="thumbcaption"></div>
                </div>
                </div><div class="contentText">
                
                <p id="text"></p>
                <ul id="elolist"></ul>
                <h2><span>Code</span></h2>
                <p>This shows a javascript implementation of this evaluation term <span id="codeTermName"></span>.</p>
                <pre id="code"></pre><ul><li id="childlist">This function calls following evaluation subterms: <a onclick="golink('Middle game evaluation');">Middle game evaluation</a>, <a onclick="golink('End game evaluation');">End game evaluation</a>, <a onclick="golink('Phase');">Phase</a>, <a onclick="golink('Scale factor');">Scale factor</a>, <a onclick="golink('Tempo');">Tempo</a></li><li id="parentlist">It is used in no parent evaluation terms.</li></ul>
                <h2 id="persquaretitle" style="display: none;">Per square values</h2>
                <div id="thumb2" class="thumb tleft" style="display: none;">
                <div class="thumbinner">
                <table class="cbTable" cellspacing="0" cellpadding="0">
                <tbody><tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                <tr><td>8</td><td colspan="8" rowspan="8" class="cbCell"><div id="chessboard2" class="cb"></div></td><td>8</td></tr>
                <tr><td>7</td><td>7</td></tr><tr><td>6</td><td>6</td></tr><tr><td>5</td><td>5</td></tr><tr><td>4</td><td>4</td></tr>
                <tr><td>3</td><td>3</td></tr><tr><td>2</td><td>2</td></tr><tr><td>1</td><td>1</td></tr>
                <tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                </tbody></table>
                <div id="thumbcaption2"></div>
                </div>
                </div>
                <div id="thumb3" class="thumb tleft" style="display: none;">
                <div class="thumbinner">
                <table class="cbTable" cellspacing="0" cellpadding="0">
                <tbody><tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                <tr><td>8</td><td colspan="8" rowspan="8" class="cbCell"><div id="chessboard3" class="cb"></div></td><td>8</td></tr>
                <tr><td>7</td><td>7</td></tr><tr><td>6</td><td>6</td></tr><tr><td>5</td><td>5</td></tr><tr><td>4</td><td>4</td></tr>
                <tr><td>3</td><td>3</td></tr><tr><td>2</td><td>2</td></tr><tr><td>1</td><td>1</td></tr>
                <tr><td></td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td></td></tr>
                </tbody></table>
                <div id="thumbcaption3"></div>
                </div>
                </div>
                <div style="clear:both;"></div>
                <h2 id="seealsotitle" style="">See also</h2><ul id="seealso"></ul>
                <div style="clear:both;"></div>
                <h2 id="extlinkstitle" style="">External links</h2><ul id="extlinks"></ul>
            </div>
        </div>
        <div id="bodyContentEdit" style="display: none;">
            Name<br>
            <input id="editName" style="width:100%;" type="text">
            Group<br>
            <input id="editGroup" style="width:100%;" type="text">
            Text<br>
            <textarea id="editText" style="width: 100%;" rows="5"></textarea><br>
            Code<br>
            <textarea id="editCode" style="width: 100%;" rows="10"></textarea><br>
            External links<br>
            <textarea id="editLinks" style="width: 100%;" rows="5"></textarea><br>
            ELO worth - Value:<input id="editEloValue" type="text"> Error: <input id="editEloError" type="text"> Link: <input id="editEloLink" type="text"><br>
            Options<br>
            <label><input id="editEval" type="checkbox">Show evaluation</label>
            <label><input id="editSquares" type="checkbox">Show per square values</label>
            <label><input id="editSquaresZero" type="checkbox">Per square values show zero</label>
            <label><input id="editHighlight" type="checkbox">Highlight squares</label>
            <label><input id="editHighlightBlack" type="checkbox">Highlight squares for black</label>
            <label><input id="editForwhite" type="checkbox">For white side</label>
            <label><input id="editForGraph" type="checkbox">For graph</label>
            <br><br>
            <input value="Apply changes" onclick="apply();" type="button">
            <input value="Duplicate this page" onclick="duplicate();" type="button">
            <input value="Remove this page" onclick="remove();" type="button">
            <input value="Apply changes + Move to end" onclick="movetoend();" type="button">
        </div>
        <div id="bodyContentGlobal" style="display: none;">
            <div class="contentText">
                <p><b>Position representation</b> and <b>global functions</b> used in evaluation terms.</p>
                <h2><span>Code</span></h2>
                <p>Position is represented with javascript object like this.</p>
                <pre id="codeGlobalPos"></pre>
                <p>Global functions board(), colorflip() and sum().</p>
                <pre id="codeGlobalFunc"></pre>
            </div>
        </div>
        <div id="bodyContentTable" style="display: none;">
            <div class="contentText">
                <div id="evalTable"></div>
            </div>
        </div>        
        <div id="bodyContentGraph" style="display: none;">
            <div class="contentText">
                <a onclick="refreshGraph(parseFEN(document.getElementById('fen').innerHTML));">Show position graph</a> |
                <a onclick="refreshGraph2();">Show game history graph</a>
                <div id="graphData"></div>
            </div>
        </div>        
    </div>
    <div>
        <div id="head">
            <div id="links">
                <ul>
                    <li><a href="http://www.stockfishchess.com/" title="Home - Stockfish - Open Source Chess Engine">Homepage</a></li>
                    <li><a href="https://github.com/official-stockfish/Stockfish" title="GitHub - official-stockfish/Stockfish: UCI chess engine">Source</a></li>
                    <li><a href="http://tests.stockfishchess.org/tests" title="Stockfish Testing Framework">Fishtest</a></li>
                    <li><a href="https://groups.google.com/forum/?fromgroups=#!forum/fishcooking" title="Forum">Fishcooking</a></li>
                </ul>
            </div>
            <div id="leftNav">
                <div class="tabs">
                    <ul>
                        <li id="liEval" class="selected"><span><a onclick="editmode(0);">Evaluation term</a></span></li>
                        <li id="liGlobal" class=""><span><a onclick="editmode(2);">Global functions</a></span></li>
                        <li id="liTable" class=""><span><a onclick="editmode(3);">Table</a></span></li>
                        <li id="liGraph" class=""><span><a onclick="editmode(4);">Graph</a></span></li>
                    </ul>
                </div>
            </div>
            <div id="rightNav">
                <div class="tabs">
                    <ul>
                        <li id="liRead" class="selected"><span><a onclick="editmode(0);">Read</a></span></li>
                        <li id="liEdit" class=""><span><a onclick="editmode(1);">Edit</a></span></li>
                        <li><span><a onclick="save();" download="">Save</a></span></li>
                    </ul>
                </div>
                <div id="searchWrapper">
                    <form id="simpleSearch" onsubmit="dosearch();return false;">
                        <input name="search" placeholder="Search or enter FEN or PGN" id="searchInput" type="search"><input name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" type="submit">
                    </form>
                </div>
            </div>
        </div>
        <div id="leftmenu"></div>
    </div>
    <div id="footer"><ul><li> This page was last modified on <span id="date">3 August 2020</span>.</li></ul><div style="clear:both"></div></div>
<script>
var PAWNVALUE = 206;
function ctrlMessage(e, message) {
  if (e == null) e = window.event;
  if (e.ctrlKey) alert(message);
}

function getGraphGroupList(pos) {
  var grouplist = [], midindex = null, endindex = null, maincode = null;
  for (var i = 0; i < data.length; i++) {
    if (data[i].name == "Middle game evaluation") midindex = i;
    if (data[i].name == "End game evaluation") endindex = i;
    if (data[i].name == "Main evaluation") maincode = data[i].code;
  }
  if (midindex == null || endindex == null || maincode == null) return;
  var zero = function() {return 0;};
  for (var i = 0; i < data.length; i++) {
    var n = data[i].name.toLowerCase().replace(/ /g, "_");
    while (i != midindex && i != endindex && maincode.indexOf("$" + n + "(") >= 0) {
      maincode = maincode.replace("$" + n + "(", "(function(){return " + eval("$" + n + "(pos)")+ ";})(");
    }
    if (data[midindex].code.indexOf("$" + n + "(") < 0
     && data[endindex].code.indexOf("$" + n + "(") < 0) continue;
    var code = data[i].code, list = [];
    for (var j = 0; j < data.length; j++) {
      if (!data[j].graph || data[j].group != data[i].group || i == j) continue;
      var n2 = data[j].name.toLowerCase().replace(/ /g, "_");
      code = code.replace("$" + n2 + "(", "$g-" + n2 + "(").replace("$" + n2 + "(", "$g-" + n2 + "(");
      list.push(n2);
    }
    if (data[i].graph) list.push(n);
    for (var j = 0; j < list.length; j++) {
      var n2 = list[j];
      if (code.indexOf("$g-" + n2 + "(") < 0 && !data[i].graph) continue;
      var mw = 0, mb = 0, ew = 0, eb = 0, func = null;
      try {
        eval("func = " + code.replace("$g-"+n2+"(","$"+n2+"(")
                             .replace("$g-"+n2+"(","$"+n2+"(")
                             .replace(/\$g\-[a-z_]+\(/g, "zero(") + ";");
        if (data[midindex].code.indexOf("$" + n + "(pos") >= 0) mw = func(pos);
        if (data[midindex].code.indexOf("$" + n + "(colorflip(pos)") >= 0) mb = func(colorflip(pos));
        if (data[endindex].code.indexOf("$" + n + "(pos") >= 0) ew = func(pos);
        if (data[endindex].code.indexOf("$" + n + "(colorflip(pos)") >= 0) eb = func(colorflip(pos));
      }
      catch (e) {
        alert(e.message);
        continue;
      }   
      var evals = [mw - mb, ew - eb];
      var index = grouplist.map(function(e) { return e.elem; }).indexOf(n2);
      if (index < 0) {
        grouplist.push({group:data[i].group,elem:n2,item:evals,hidden:false,mc:pos.m[1]});
      } else {
        grouplist[index].item[0] += evals[0];
        grouplist[index].item[1] += evals[1];
      }        
    }

  }
  grouplist.sort(function(a,b) {return (a.group > b.group) ? 1 : ((b.group > a.group) ? -1 : 0);} );
  maincode = maincode.replace("function $$(pos)","function $$(PMG,PEG)")
                     .replace("$middle_game_evaluation(pos)","PMG")
                     .replace("$end_game_evaluation(pos)","PEG")  
  var mainfunc = eval("(" + maincode + ")");
  for (var i = 0; i < grouplist.length; i++) {
    grouplist[i].item.push(mainfunc(grouplist[i].item[0], grouplist[i].item[1]) - mainfunc(0, 0));
  }
  grouplist.push({group:"Tempo",elem:"tempo",item:[mainfunc(0, 0),mainfunc(0, 0),mainfunc(0, 0)],hidden:false,mc:pos.m[1]});
  return grouplist;
}
var _graph2data = null, _graph2keep = false;
function refreshGraph(pos) {
  if (_graph2keep == true) { _graph2keep = false; return; }
  _graph2data = null;
  var grouplist = getGraphGroupList(pos);
  var pawn = PAWNVALUE, xscale = 2;
  for (var i = 0; i < grouplist.length; i++) while (Math.abs(grouplist[i].item[2]) >= xscale * pawn) xscale++;
  if (xscale > 10) while (xscale % 4 != 0) xscale++;
  var total = 0;
  for (var i = 0; i < grouplist.length; i++) total += grouplist[i].item[2];
  var gData = "<div class=\"graph\" onclick=\"ctrlMessage(event,'TOTAL="+(total)+"');\">";
  gData += "<div class=\"background\"></div><div class=\"line0\"></div>";
  for (var i = 1; i < xscale + 1; i++) {
    if (xscale > 10 && i % 4 != 0) continue;
    if (i < xscale) {
      gData += "<div class=\"line1\" style=\"right:" + (258 + (243 / xscale) * i) + "px\"></div>";
      gData += "<div class=\"line1\" style=\"right:" + (258 - (243 / xscale) * i) + "px\"></div>";
    }
    gData += "<div class=\"xlabel\" style=\"right:" + (248 + (243 / xscale) * i) + "px\">"+(-i)+"P</div>";
    gData += "<div class=\"xlabel\" style=\"right:" + (248 - (243 / xscale) * i) + "px\">"+(i)+"P</div>";
  }
  gData += "<div class=\"xlabel\" style=\"right:" + (248) + "px\">0P</div>";
  var colorlist = [[0,173,220],[240,240,22],[234,21,122],
                   [127,209,59],[22,240,240],[254,184,10]], colorindex = 0;
  for (var i = 0; i < grouplist.length; i++) {
    if (i > 0 && grouplist[i-1].group != grouplist[i].group) colorindex = (colorindex + 1) % 6;
    var elo = null
    for (var j = 0; j < data.length; j++) if (data[j].name.toLowerCase().replace(/ /g, "_") == grouplist[i].elem) elo = data[j].elo;
    gData += "<div class=\"label\" "+(elo!=null?"title=\"ELO worth: "+elo.value+"\" ":"")+"onclick=\"golink(this)\">";
    gData += grouplist[i].elem[0].toUpperCase()+grouplist[i].elem.replace(/\_/g," ").substring(1);
    gData += "</div>";
    var v = 243 * grouplist[i].item[2] / xscale / pawn;
    var color = "background: linear-gradient(rgb("+(colorlist[colorindex][0])+", "
                                                  +(colorlist[colorindex][1])+", "
                                                  +(colorlist[colorindex][2])+"), rgb("
                                                  +(colorlist[colorindex][0]*0.75 << 0)+", "
                                                  +(colorlist[colorindex][1]*0.8 << 0)+", "
                                                  +(colorlist[colorindex][2]*0.9 << 0)+"));";
    if (v != 0) {
      var r, w;
      if (v > 0) { r = 258-v; w = v; }
            else { r = 258; w = -v; }
      var title = "MG=" + grouplist[i].item[0] + "\nEG=" + grouplist[i].item[1] + "\nTOTAL=" +  grouplist[i].item[2];
      gData += "<div class=\"bar\" style=\"right:"+(r)+"px;top:"+(16+i*17)+"px;width:" + (w) + "px;"+color+"\" title=\""+title+"\"></div>";
    }
  }
  gData += "</div>";
  document.getElementById('graphData').innerHTML = gData;
}

function graph2cb(elem, index) {
  for (var j = 0; j < _graph2data.length; j++) {
    if (index < 0) {
      for (var i = 0; i < _graph2data[j].length; i++)
        _graph2data[j][i].hidden = index != -1;
    }
    else _graph2data[j][index].hidden = !elem.checked;
  }
  adjustGraph2();
}
function graph2custom() {
  var funccode = prompt("Please enter your function", "$middle_game_evaluation(pos)");
  if (funccode == null || funccode.length == 0) return;
  for (var i = 0; i < Math.min(_graph2data.length, _history.length); i++) {
    var pos = parseFEN(_history[i]);
    var result = 0;
    try { eval("result = (" + funccode + ")"); }
    catch (e) {}       
    _graph2data[i].push({group:"Custom",elem:funccode,item:[null, null, result],hidden:false,mc:pos.m[1]});
  }
  adjustGraph2();
}
function adjustGraph2(nofilter) {
  if (_graph2data == null) return;
  var mcfrom = null, mcto = null;
  if (!nofilter) {
    mcfrom = parseInt(document.getElementById('g2from').value);
    mcto = parseInt(document.getElementById('g2to').value);
    if (isNaN(mcfrom)) mcfrom = null;
    if (isNaN(mcto)) mcto = null;
  }
  var mcmin = mcfrom, mcmax = mcto;
  var full = _graph2data.length >= _history.length;
  var len = _graph2data.length, datafilt = [];
  for (var j = 0; j < len; j++)
  {
    var hasdata = false;
    for (var i = 0; i < _graph2data[j].length; i++) {
      if ((mcfrom == null || mcfrom <= _graph2data[j][i].mc) && (mcto == null || mcto >= _graph2data[j][i].mc)) {
        if (mcmin == null || mcmin > _graph2data[j][i].mc) mcmin = _graph2data[j][i].mc;
        if (mcmax == null || mcmax < _graph2data[j][i].mc) mcmax = _graph2data[j][i].mc;
        hasdata = true;
      }
    }
    if (hasdata) datafilt.push(j);
  }
  var len2 = datafilt.length, pawn = PAWNVALUE, yscale = 2;
  for (var j2 = 0; j2 < len2; j2++) {
    var j = datafilt[j2];
    for (var i = 0; i < _graph2data[j].length; i++) {
      if (_graph2data[j][i].hidden) continue;
      while (Math.abs(_graph2data[j][i].item[2]) >= yscale * pawn) yscale++;
    }
  }
  if (yscale > 10) while (yscale % 4 != 0) yscale++;
  var gDataPoints = "", gDataSvg = "";
  var checkboxes = "";  
  gDataSvg += "<line x1=\"41\" y1=\""+(254)+"\" x2=\""+(23+len2*17)+"\" y2=\""+(254)+"\" style=\"stroke:rgba(255,255,255,0.5);stroke-width:1\"/>";
  for (var i = 1; i < yscale + 1; i++) {
    if (yscale > 10 && i % 4 != 0) continue;
    var v = (243 / yscale) * i;
    if (i < yscale) {
      gDataSvg += "<line x1=\"41\" y1=\""+(254+v)+"\" x2=\""+(23+len2*17)+"\" y2=\""+(254+v)+"\" style=\"stroke:rgba(255,255,255,0.2);stroke-width:1\"/>";
      gDataSvg += "<line x1=\"41\" y1=\""+(254-v)+"\" x2=\""+(23+len2*17)+"\" y2=\""+(254-v)+"\" style=\"stroke:rgba(255,255,255,0.2);stroke-width:1\"/>";
    }
    gDataPoints += "<div class=\"ylabel\" style=\"top:" + (245+v) + "px\">"+(-i)+"P</div>";
    gDataPoints += "<div class=\"ylabel\" style=\"top:" + (245-v) + "px\">"+(i)+"P</div>";
  }
  gDataPoints += "<div class=\"ylabel\" style=\"top:" + (245) + "px\">0P</div>";
  var lastx = 0;
  for (var j2 = 0; j2 < (len2 == 0 && _graph2data.length > 0 ? 1 : len2); j2++) {
    var j = len2 == 0 ? 0 : datafilt[j2];
    for (var i = 0; i < _graph2data[j].length; i++) {
      var c1 = (22 + (i % 4) * 72), c2 = (22 + ((((i / 4) << 0)+1) % 4) * 72), c3 = (22 + (((i / 16) << 0) % 3) * 109), light=2*c1+7*c2+c3>1024;
      if (j2==0) checkboxes += "<label style=\"background-color:rgba("+c1+","+c2+","+c3+",0.8);color:"+(light?"black":"white")+"\"><input type=\"checkbox\" "+(_graph2data[j][i].hidden?"":"checked")+" onclick=\"graph2cb(this,"+i+");\"><span>"+_graph2data[j][i].elem[0].toUpperCase()+_graph2data[j][i].elem.replace(/\_/g," ").substring(1)+"</span></label>";

      if (i == 0 && (j == 0 || _graph2data[j][i].mc != _graph2data[j-1][i].mc && lastx != j2 - 1)) {
        gDataPoints += "<div class=\"xlabel\" style=\"left:" + (j2*17+24) + "px\">"+(_graph2data[j][i].mc)+"</div>";
        lastx = j2;
      }

      if (len2 == 0 || _graph2data[j][i].hidden) continue;
      var v = 243 * _graph2data[j][i].item[2] / yscale / pawn;
      if (full) {
        var color = "background: linear-gradient(rgb("+(c1)+", "+(c2)+", "+(c3)+
                                             "), rgb("+(c1*0.75 << 0)+", "+(c2*0.8 << 0)+", "+(c3*0.9 << 0)+"));";
        var title = _history[j] + "\n";
        title += _graph2data[j][i].group == "Custom" ? _graph2data[j][i].elem : _graph2data[j][i].elem[0].toUpperCase()+_graph2data[j][i].elem.replace(/\_/g," ").substring(1);
        if (_graph2data[j][i].item[0] != null) title += "\nMG=" + _graph2data[j][i].item[0];
        if (_graph2data[j][i].item[1] != null) title += "\nEG=" + _graph2data[j][i].item[1];
        title += "\nTOTAL=" +  _graph2data[j][i].item[2];
        var pagescript = _graph2data[j][i].group == "Custom" ? "" : "editmode(0);showPage('"+_graph2data[j][i].elem+"');";
        var clickscript = "if (event==null) event=window.event;if (event.ctrlKey) {"+pagescript+"} else {_graph2keep=true;historymove("+(j)+"-_historyindex);_graph2keep=false;}";

        gDataPoints += "<div class=\"point\" style=\"top:"+(254-v-3)+"px;left:"+(41+j2*17-3)+"px;"+color+"\" title=\""+title+"\" onclick=\""+clickscript+"\"></div>";
      }
      if (j2 > 0) {
        var v2 = 243 * _graph2data[j-1][i].item[2] / yscale / pawn;
        gDataSvg += "<line x1=\""+(j2*17+24)+"\" y1=\""+(254-v2)+"\" x2=\""+(41+j2*17)+"\" y2=\""+(254-v)+"\" style=\"stroke:rgb("+c1+","+c2+","+c3+");stroke-width:2\"/>";
      }
    }
  }
  checkboxes += "<label style=\"background-color:rgba(255,255,255,0.8);color:black;\" onclick=\"graph2cb(this,-1);\"><span>Show all</span></label>";
  checkboxes += "<label style=\"background-color:rgba(0,0,0,0.8);color:white;\" onclick=\"graph2cb(this,-2);\"><span>Hide all</span></label>";
  checkboxes += "<label style=\"background: linear-gradient(rgb(255,0,0), rgb(255,255,0));color:black;\" onclick=\"graph2custom();\"><span>Add custom...</span></label>";
  checkboxes += "<hr/><div class=\"graph2filter\">Move number from <input id=\"g2from\" type=\"text\"> to <input id=\"g2to\" type=\"text\"> <label style=\"background: linear-gradient(rgb(0,255,0), rgb(220,255,220));color:black;\" onclick=\"adjustGraph2();\"><span>Apply</span></label><label style=\"background: linear-gradient(rgb(255,0,0), rgb(255,220,220));color:black;\" onclick=\"adjustGraph2(true);\"><span>Reset</span></label></div>";
  document.getElementById('graphData').innerHTML = "<div class=\"graph2\" style=\"width:"+(len2*17+39)+"px\">"
    + "<div class=\"background\"></div>"
    + "<svg style='width: 100%; height: 100%;' class='shadow'>"+gDataSvg+"</svg>"
    + gDataPoints
    + "</div><div class=\"graph2legend\">" + checkboxes + "</div>";
  document.getElementById('g2from').value = mcmin == null ? "" : mcmin;
  document.getElementById('g2to').value = mcmax == null ? "" : mcmax;
}
function refreshGraph2() {
  _graph2data = [];
  var fnc = function() {
    if (_graph2data == null) return;
    var i = _graph2data.length;
    var data = getGraphGroupList(parseFEN(_history[i]));
    var total = 0;
    for (var j = 0; j < data.length; j++) total += data[j].item[2];
    data.push({group:"Custom",elem:"total",item:[null, null, total],hidden:false,mc:data[0].mc});
    _graph2data.push(data);

    if (i % 8 == 0 || _graph2data.length >= _history.length) adjustGraph2(true);
    if (_graph2data.length >= _history.length || _graph2data.length != i + 1) return;
    window.setTimeout(fnc, 0);
  };
  fnc();
}

function refreshTable(pos) {
  var grouplist = [], midindex = null, endindex = null;
  for (var i = 0; i < data.length; i++) {
    if (data[i].name == "Middle game evaluation") midindex = i;
    if (data[i].name == "End game evaluation") endindex = i;
  }
  if (midindex == null || endindex == null) return;
  for (var i = 0; i < data.length; i++) {
    var n = data[i].name.toLowerCase().replace(/ /g, "_");
    if (data[midindex].code.indexOf("$" + n + "(") < 0
     && data[endindex].code.indexOf("$" + n + "(") < 0) continue;
    var mw = 0, mb = 0, ew = 0, eb = 0, func = null;
    try {
      eval("func = $" + n + ";");
      if (data[midindex].code.indexOf("$" + n + "(pos") >= 0) mw = func(pos);
      if (data[midindex].code.indexOf("$" + n + "(colorflip(pos)") >= 0) mb = func(colorflip(pos));
      if (data[endindex].code.indexOf("$" + n + "(pos") >= 0) ew = func(pos);
      if (data[endindex].code.indexOf("$" + n + "(colorflip(pos)") >= 0) eb = func(colorflip(pos));
    }
    catch (e) {
      continue;
    }
    var evals = [mw, ew, mb, eb, mw - mb, ew - eb];
    var index = grouplist.map(function(e) { return e.group; }).indexOf(data[i].group);
    if (index < 0) {
      grouplist.push({group:data[i].group,item:evals});
    } else {
      for (var j = 0; j < grouplist[index].item.length; j++) {
        grouplist[index].item[j] += evals[j];
      }
    }
  }
  grouplist.sort(function(a,b) {return (a.group > b.group) ? 1 : ((b.group > a.group) ? -1 : 0);} );
  var evaltable = "<table class='cTable'>";
  evaltable += "<tr><th rowspan='2'>Group</th><th colspan='2'>White</th><th colspan='2'>Black</th><th colspan='2'>Total</th></tr>";
  evaltable += "<tr><th>Middle Game</th><th>End Game</th><th>Middle Game</th><th>End Game</th><th>Middle Game</th><th>End Game</th></tr>";
  var grouplistsum = [0, 0, 0, 0, 0, 0];
  for (var i = 0; i < grouplist.length; i++) {
    evaltable += "<tr><td>" + grouplist[i].group + "</td>";
    for (var j = 0; j < grouplist[i].item.length; j++) {
      evaltable += "<td>" + grouplist[i].item[j] + "</td>";
      grouplistsum[j] += grouplist[i].item[j];
    }
    evaltable += "</tr>";
  }
  evaltable += "<tr><th>Total</th>";
  for (var j = 0; j < grouplistsum.length; j++) evaltable += "<th>" + grouplistsum[j] + "</th>";
  evaltable += "</tr>";
  evaltable += "</table>";
  document.getElementById('evalTable').innerHTML = evaltable;
}
function command(text) {
  if (text.split("/").length == 8 && text.split(".").length == 1) {
    document.getElementById('fen').innerHTML = text;
    _history = [document.getElementById('fen').innerHTML]; _historyindex = 0;
    historymove(0);
  } else if (text.split(".").length > 1) {
      text = " " + text.replace(/\./g," ").replace(/(\[FEN [^\]]+\])+?/g, function ($0, $1) { return $1.replace(/\[|\]|"/g,"").replace(/\s/g,"."); });
      text = text.replace(/\[Event /g, "* [Event ").replace(/\s(\[[^\]]+\])+?/g, "").replace(/(\{[^\}]+\})+?/g, "");
      var r = /(\([^\(\)]+\))+?/g; while (r.test(text)) text = text.replace(r, "");
      text = text.replace(/0-0-0/g, "O-O-O").replace(/0-0/g, "O-O").replace(/(1\-0|0\-1|1\/2\-1\/2)/g," * ")
                 .replace(/\s\d+/g, " ").replace(/\$\d+/g, "").replace(/\?/g,"");
      var moves = text.replace(/\s/g, " ").replace(/ +/g, " ").trim().split(' ');
      var init = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
      var pos = parseFEN(init);
      _history = [init]; _historyindex = 0; gm=0;
      for (var i = 0; i < moves.length; i++) {
        if (moves[i].length == 0) continue;
        if ("*".indexOf(moves[i][0]) == 0) {
          if (i < moves.length - 1) {
            pos = parseFEN(init);
            historyadd(generateFEN(pos));
            gm++;
          }
          continue;
        } else if (moves[i].indexOf("FEN.") == 0) {
          pos = parseFEN(moves[i].substring(4).replace(/\./g, " "));
          if (_history[_historyindex] == init) _historyindex--;
          historyadd(generateFEN(pos));
          continue;
        }
        if (moves[i] == "--") { pos.w = !pos.w; historyadd(generateFEN(pos)); continue; }
        var move = parseMove(pos, moves[i]);
        if (move == null) { alert("incorrect move: "+moves[i] + " "+ gm); break; }
        pos = doMove(pos, move.from, move.to, move.p);
        historyadd(generateFEN(pos));
      }
      document.getElementById('fen').innerHTML = generateFEN(pos);
      historymove(0);
  } else if (text.toLowerCase() == "reset") {
    document.getElementById('fen').innerHTML = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
    _history = [document.getElementById('fen').innerHTML]; _historyindex = 0;
    historymove(0);
  } else if (text.toLowerCase() == "colorflip") {
    document.getElementById('fen').innerHTML = generateFEN(colorflip(parseFEN(document.getElementById('fen').innerHTML)));
    showBoard();
  } else if (text.toLowerCase() == "sidetomove") {
    document.getElementById('fen').innerHTML = document.getElementById('fen').innerHTML.replace(" w ", " ! ").replace(" b ", " w ").replace(" ! ", " b ");
    showBoard();
  } else if (text.toLowerCase() == "bench") {
    var list = ["rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
                "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 10",
                "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 11",
                "4rrk1/pp1n3p/3q2pQ/2p1pb2/2PP4/2P3N1/P2B2PP/4RRK1 b - - 7 19",
                "rq3rk1/ppp2ppp/1bnpb3/3N2B1/3NP3/7P/PPPQ1PP1/2KR3R w - - 7 14",
                "r1bq1r1k/1pp1n1pp/1p1p4/4p2Q/4Pp2/1BNP4/PPP2PPP/3R1RK1 w - - 2 14",
                "r3r1k1/2p2ppp/p1p1bn2/8/1q2P3/2NPQN2/PPP3PP/R4RK1 b - - 2 15",
                "r1bbk1nr/pp3p1p/2n5/1N4p1/2Np1B2/8/PPP2PPP/2KR1B1R w kq - 0 13",
                "r1bq1rk1/ppp1nppp/4n3/3p3Q/3P4/1BP1B3/PP1N2PP/R4RK1 w - - 1 16",
                "4r1k1/r1q2ppp/ppp2n2/4P3/5Rb1/1N1BQ3/PPP3PP/R5K1 w - - 1 17",
                "2rqkb1r/ppp2p2/2npb1p1/1N1Nn2p/2P1PP2/8/PP2B1PP/R1BQK2R b KQ - 0 11",
                "r1bq1r1k/b1p1npp1/p2p3p/1p6/3PP3/1B2NN2/PP3PPP/R2Q1RK1 w - - 1 16",
                "3r1rk1/p5pp/bpp1pp2/8/q1PP1P2/b3P3/P2NQRPP/1R2B1K1 b - - 6 22",
                "r1q2rk1/2p1bppp/2Pp4/p6b/Q1PNp3/4B3/PP1R1PPP/2K4R w - - 2 18",
                "4k2r/1pb2ppp/1p2p3/1R1p4/3P4/2r1PN2/P4PPP/1R4K1 b - - 3 22",
                "3q2k1/pb3p1p/4pbp1/2r5/PpN2N2/1P2P2P/5PP1/Q2R2K1 b - - 4 26",
                "6k1/6p1/6Pp/ppp5/3pn2P/1P3K2/1PP2P2/3N4 b - - 0 1",
                "3b4/5kp1/1p1p1p1p/pP1PpP1P/P1P1P3/3KN3/8/8 w - - 0 1",
                "2K5/p7/7P/5pR1/8/5k2/r7/8 w - - 0 1",
                "8/6pk/1p6/8/PP3p1p/5P2/4KP1q/3Q4 w - - 0 1",
                "7k/3p2pp/4q3/8/4Q3/5Kp1/P6b/8 w - - 0 1",
                "8/2p5/8/2kPKp1p/2p4P/2P5/3P4/8 w - - 0 1",
                "8/1p3pp1/7p/5P1P/2k3P1/8/2K2P2/8 w - - 0 1",
                "8/pp2r1k1/2p1p3/3pP2p/1P1P1P1P/P5KR/8/8 w - - 0 1",
                "8/3p4/p1bk3p/Pp6/1Kp1PpPp/2P2P1P/2P5/5B2 b - - 0 1",
                "5k2/7R/4P2p/5K2/p1r2P1p/8/8/8 b - - 0 1",
                "6k1/6p1/P6p/r1N5/5p2/7P/1b3PP1/4R1K1 w - - 0 1",
                "1r3k2/4q3/2Pp3b/3Bp3/2Q2p2/1p1P2P1/1P2KP2/3N4 w - - 0 1",
                "6k1/4pp1p/3p2p1/P1pPb3/R7/1r2P1PP/3B1P2/6K1 w - - 0 1",
                "8/3p3B/5p2/5P2/p7/PP5b/k7/6K1 w - - 0 1"];
    var total = 0, result = "Stockfish Evaluation Guide\n";
    for (var i = 0; i < list.length; i++) {
      var p = parseFEN(list[i]);
      var v = $main_evaluation(p);
      if (isWhiteCheck(p) || isWhiteCheck(colorflip(p))) v = "CHECK";
      else total += v;
      result += list[i] + " = " + v + "\n";
    }
    result += "===========================\nTotal : " + total + "\n";
    alert(result);
  } else {
    editmode(0);
    showPage(text.toLowerCase().replace(/ /g, "_"), true);
  }
}
function dosearch() {
  var text = document.getElementById('searchInput').value;
  document.getElementById('searchInput').value = "";
  command(text);
}
function editmode(edit) {
  document.getElementById('liRead').className = edit != 1 ? "selected" : "";
  document.getElementById('liEdit').className = edit == 1 ? "selected" : "";
  document.getElementById('liEval').className = edit < 2 ? "selected" : "";
  document.getElementById('liGlobal').className = edit == 2 ? "selected" : "";
  document.getElementById('liTable').className = edit == 3 ? "selected" : "";
  document.getElementById('liGraph').className = edit == 4 ? "selected" : "";
  
  document.getElementById('info').style.display = edit != 1 ? "" : "none";
  document.getElementById('bodyContent').style.display = edit == 0 ? "" : "none";
  document.getElementById('bodyContentEdit').style.display = edit == 1 ? "" : "none";
  document.getElementById('bodyContentGlobal').style.display = edit == 2 ? "" : "none";
  document.getElementById('bodyContentTable').style.display = edit == 3 ? "" : "none";
  document.getElementById('bodyContentGraph').style.display = edit == 4 ? "" : "none";
  if (edit == 1) {
    document.getElementById('editName').value = data[curindex].name;
    document.getElementById('editGroup').value = data[curindex].group;
    document.getElementById('editText').value = data[curindex].text;
    document.getElementById('editCode').value = data[curindex].code;
    document.getElementById('editLinks').value = data[curindex].links.join("\n");
    document.getElementById('editEval').checked = data[curindex].eval;
    document.getElementById('editSquares').checked = data[curindex].squares > 0;
    document.getElementById('editSquaresZero').checked = data[curindex].squares > 1;
    document.getElementById('editHighlight').checked = data[curindex].highlight > 0;
    document.getElementById('editForwhite').checked = data[curindex].forwhite;
    document.getElementById('editForGraph').checked = data[curindex].graph;
    document.getElementById('editHighlightBlack').checked = data[curindex].highlight > 1;
    if (data[curindex].elo != null) {
      document.getElementById('editEloValue').value = data[curindex].elo.value;
      document.getElementById('editEloError').value = data[curindex].elo.error;
      document.getElementById('editEloLink').value = data[curindex].elo.link;
    } else {
      document.getElementById('editEloValue').value = "";
      document.getElementById('editEloError').value = "";
      document.getElementById('editEloLink').value = "";
    }
  }
  document.getElementById('headline').innerHTML = edit == 2 ? "Global functions" :
                                                  edit == 3 ? "Table" :
                                                  edit == 4 ? "Graph" : data[curindex].name ;
  if (edit == 2) {
    var pos = parseFEN(document.getElementById('fen').innerHTML);
    var s = "pos = {// chessboard\n       b: [" + JSON.stringify(pos.b[0]);
    for (var i = 1; i < 8; i++) s += ",\n           " + JSON.stringify(pos.b[i]);
    s += "],\n\n       // castling rights\n       c: " + JSON.stringify(pos.c) + "\n\n       // enpassant\n";
    s += "       e: " + JSON.stringify(pos.e) + "\n\n       // side to move\n"
    s += "       w: " + JSON.stringify(pos.w) + "\n\n       // move counts\n       m: " + JSON.stringify(pos.m) + "}\n";
    document.getElementById('codeGlobalPos').innerHTML = s;
    document.getElementById('codeGlobalFunc').innerHTML = board + "\n" + colorflip + "\n" + sum;
  }
  var targetContent = edit == 3 ? 'bodyContentTable' :
                      edit == 4 ? 'bodyContentGraph' : 'bodyContent';
  var t = document.getElementById('thumb'), p = document.getElementById(targetContent);
  p.insertBefore(t, p.children[0]);
  if (edit == 0 || edit == 3 || edit == 4) showBoard();
}

function apply() {
  var d = new Date();
  var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
  document.getElementById("date").innerHTML = d.getDate() + " " + monthNames[d.getMonth()] + " " + d.getFullYear();
  var name = document.getElementById('editName').value;
  if (name.length > 0) name = name[0].toUpperCase() + name.replace(/_/g, " ").substring(1).toLowerCase();
  data[curindex].name = name;
  data[curindex].group = document.getElementById('editGroup').value;
  data[curindex].text = document.getElementById('editText').value;
  data[curindex].code = document.getElementById('editCode').value;
  
  var links = document.getElementById('editLinks').value;
  if (links.length == 0) links = []; else links = links.split("\n");
  for (var i = 0; i < links.length; i++) links[i] = links[i].split(",");
  data[curindex].links = links;
  data[curindex].eval = document.getElementById('editEval').checked;
  data[curindex].squares = document.getElementById('editSquares').checked ?
                            (document.getElementById('editSquaresZero').checked ? 2 : 1) : 0;
  data[curindex].highlight = document.getElementById('editHighlight').checked ?
                            (document.getElementById('editHighlightBlack').checked ? 2 : 1) : 0;
  data[curindex].forwhite = document.getElementById('editForwhite').checked;
  data[curindex].graph = document.getElementById('editForGraph').checked;
  if (document.getElementById('editEloValue').value.length > 0
   && document.getElementById('editEloError').value.length > 0
   && document.getElementById('editEloLink').value.length > 0) {
    data[curindex].elo = {value:document.getElementById('editEloValue').value,
                          error:document.getElementById('editEloError').value,
                          link:document.getElementById('editEloLink').value};
  } else data[curindex].elo = null;
  if (doEval()) editmode(0);
  showMenu();
  updatePage();
}

function duplicate() {
  if (confirm('Are you sure you want to duplicate this page?')) {
    data.push({});
    curindex = data.length - 1;
    apply();
  }  
}

function remove() {
  if (confirm('Are you sure you want to remove this page?')) {
    data.splice(curindex, 1);
    curindex = 0;
    editmode(0);
    showMenu();
    updatePage();
  }  
}

function movetoend() {
  var i = curindex;
  data.push({});
  curindex = data.length - 1;
  apply();
  data.splice(i, 1);
  curindex = data.length - 1;
  editmode(0);
  showMenu();
  updatePage();
}

function doEval() {
  try {
    for (var i = 0; i < data.length; i++) {
        eval("$" + data[i].name.toLowerCase().replace(/ /g, "_") + " = " + data[i].code + ";");
    }
  }
  catch (e) {
    alert("error in code: " + e.message);
    return false;
  }
  return true;
}

function save() {
  if (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > 0) {
    alert("not supported in IE."); return;
  }  
  editmode(0);
  document.getElementById('leftmenu').innerHTML = "";
  document.getElementById('text').innerHTML = "";
  document.getElementById('elolist').innerHTML = "";
  document.getElementById('code').innerHTML = "";
  document.getElementById('headline').innerHTML = "";
  document.getElementById('codeTermName').innerHTML = "";
  document.getElementById('chessboard1').innerHTML = "";
  document.getElementById('chessboard2').innerHTML = "";
  document.getElementById('chessboard3').innerHTML = "";
  document.getElementById('thumbcaption').innerHTML = "";
  document.getElementById('thumbcaption2').innerHTML = "";
  document.getElementById('thumbcaption3').innerHTML = "";
  document.getElementById('extlinks').innerHTML = "";
  document.getElementById("seealso").innerHTML = "";
  document.getElementById("codeGlobalPos").innerHTML = "";
  document.getElementById("codeGlobalFunc").innerHTML = "";
  document.getElementById("evalTable").innerHTML = "";
  document.getElementById("graphData").innerHTML = "";

  document.getElementById("editText").style = "width: 100%;";
  document.getElementById("editCode").style = "width: 100%;";
  document.getElementById("editLinks").style = "width: 100%;";
  
  document.getElementById('loadData').innerHTML = "var data = [], curindex = null;\n";
  for (var i = 0; i < data.length; i++) {
    document.getElementById('loadData').innerHTML += "data.push(" + JSON.stringify(data[i]) + ");\n";
  }
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent("<!DOCTYPE html>\n"+document.documentElement.outerHTML));
  element.setAttribute('download', 'saved.html');
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
  showMenu();
  updatePage();
}

function golink(elem) {
  var v = '';
  if (elem && elem.nodeType && elem.innerHTML && elem.innerHTML.length > 0) v = elem.innerHTML;
  else if (elem && elem.length > 0) v = elem; else return;
  editmode(0);
  showPage(v.toLowerCase().replace(/ /g, "_"));
}
function getParameterByName(name, url) {
  if (!url) {
    url = window.location.href;
  }
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
      results = regex.exec(url);
  if (!results || !results[2]) return "";
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}
function menuExpandCollapse(elem) {
  var b = elem.nextSibling;
  if (b == null) return;
  if (b.style.display != "none") b.style.display = "none"; else b.style.display = "";
}
function showMenu() {
  document.getElementById('leftmenu').innerHTML = "<div id=\"logo\"><a onclick=\"editmode(0);showPage('main_evaluation');\"></a></div>";
  var grouplist = [{group:"",item:""}];
  for (var i = 0; i < data.length; i++) {
    var index = grouplist.map(function(e) { return e.group; }).indexOf(data[i].group);
    if (index < 0) {
      grouplist.push({group:data[i].group,item:"<li><a onclick=\"golink(this);\">" + data[i].name + "</a></li>"});
    } else {
      grouplist[index].item += "<li><a onclick=\"golink(this);\">" + data[i].name + "</a></li>";
    }
  }
  grouplist.sort(function(a,b) {return (a.group > b.group) ? 1 : ((b.group > a.group) ? -1 : 0);} );
  for (var i = 0; i < grouplist.length; i++) {
    var div = document.createElement('div');
    div.className = "group";
    div.innerHTML = "<h3"
     + (grouplist[i].group.length > 0 ? " onclick=\"menuExpandCollapse(this);\"" : "")
     + ">" + grouplist[i].group + "</h3>"
     + "<div class=\"body\""
     + (grouplist[i].group.length > 0 ? "style=\"display:none;\"" : "")
     + "><ul>" + grouplist[i].item + "</ul></div>";
    document.getElementById('leftmenu').appendChild(div);
  } 
}
function updatePage() {
  var n1 = data[curindex].name, n2 = n1.toLowerCase().replace(/ /g, "_");
  document.getElementById('text').innerHTML = data[curindex].text.replace("$", n1).replace(/\[\[/g,"<a onclick=\"golink(this);\">").replace(/\]\]/g,"</a>");
  document.getElementById('elolist').innerHTML = 
    data[curindex].elo == null ? "" :
    "<li>ELO worth: <b>"+data[curindex].elo.value+"</b> ±"+data[curindex].elo.error+" <sup style=\"font-size:80%\"><a href=\""+data[curindex].elo.link+"\" target=\"_blank\">[test]</a></sup></li>";
  document.getElementById('code').innerHTML = data[curindex].code.replace(/\$\$/g, n2).replace(/\$/g, "");
  document.getElementById('headline').innerHTML = n1;
  document.getElementById('codeTermName').innerHTML = "\"" + n1 + "\"" + (data[curindex].forwhite ? " from the point of view of white player" : "");
  showBoard();
  var menu = document.getElementById('leftmenu');
  for (var i = 0; i < menu.children.length; i++) {
    if (menu.children[i].className == "group") {
      if (menu.children[i].children[0].innerHTML == data[curindex].group) {
        if (menu.children[i].children[1] != null) menu.children[i].children[1].style.display = "";
      }
    }
  }
}

function showPage(name, search) {
  var found = false, matchindex = -1, matchlen = -1;
  for (var i = 0; i < data.length; i++) {
    if (data[i].name.toLowerCase().replace(/ /g, "_") == name || ((name == null || name == "") && i == 0)) {
      curindex = i;
      found = true;
      updatePage();
    }
    if (search && data[i].name.toLowerCase().replace(/ /g, "_").indexOf(name) >= 0) {
      var len = data[i].name.length;
      if (matchindex == -1 || len < matchlen) { matchindex = i; matchlen = len; }
    }
  }
  if (!found) {
    if (!search && confirm("Page not found. Do you want to create new one?")) {
      data.push({});
      curindex = data.length - 1;
      document.getElementById('editName').value = name;
      document.getElementById('editGroup').value = "";
      document.getElementById('editText').value = "<b>$</b>. No description available.";
      document.getElementById('editCode').value = "function $$(pos, square) {\n  return 0;\n}";
      document.getElementById('editLinks').value = "";
      document.getElementById('editEval').checked = false;
      document.getElementById('editSquares').checked = false;
      document.getElementById('editSquaresZero').checked = false;
      document.getElementById('editHighlight').checked = false;
      document.getElementById('editForwhite').checked = false;
      document.getElementById('editForGraph').checked = false;
      document.getElementById('editHighlightBlack').checked = false;
      apply();
    }
    if (search && matchindex < 0) {
      alert("Page not found.");
    } else if (search && matchindex >= 0) {
      curindex = matchindex;
      updatePage();
    }
  }
}
function showLegalMoves(from) {
  var pos = parseFEN(document.getElementById('fen').innerHTML);
  var elem = document.getElementById('chessboard1');
  for (var i=0; i<elem.children.length; i++) {
    var div = elem.children[i];
    if (div.tagName != 'DIV') continue;
    var x = parseInt(div.style.left.replace("px","")) / 28;
    var y = parseInt(div.style.top.replace("px","")) / 28;
    div.className = div.className.split(' ')[0] + " " + div.className.split(' ')[1];
    if (isLegal(pos, from, {x:x,y:y})) div.className += " h3";
  }
}
function showBoard() {
  var showindex = document.getElementById('bodyContentTable').style.display == ""
               || document.getElementById('bodyContentGraph').style.display == "" ? 0 : curindex;
  var pos = parseFEN(document.getElementById('fen').innerHTML);
  var func = null, cureval = null, curevalflip = null, n2 = data[showindex].name.toLowerCase().replace(/ /g, "_");
  document.getElementById('buttonstm').className = pos.w ? "on white" : "on black";
  document.getElementById('buttonstm').title = pos.w ? "white to move" : "black to move";
  document.getElementById('buttonstm').innerHTML = pos.w ? "w" : "b";
  
  try {
    eval("func = $" + n2 + ";");
    cureval = func(pos);
    if (data[showindex].forwhite) curevalflip = func(colorflip(pos));
  }
  catch (e) {
    cureval = curevalflip = "[ERROR: " + e.message + "]";
  }
  
  var elem = document.getElementById('chessboard1');
  var elem2 = document.getElementById('chessboard2');
  var elem3 = document.getElementById('chessboard3');
  document.getElementById('persquaretitle').style.display = data[showindex].squares ? "" : "none";
  document.getElementById('thumb2').style.display = data[showindex].squares ? "" : "none";
  document.getElementById('thumb3').style.display = data[showindex].squares && data[showindex].forwhite ? "" : "none";
  while (elem.firstChild) elem.removeChild(elem.firstChild);
  while (elem2.firstChild) elem2.removeChild(elem2.firstChild);
  while (elem3.firstChild) elem3.removeChild(elem3.firstChild);
  for (var x = 0; x < 8; x++) for (var y = 0; y < 8; y++) {
    var div = document.createElement('div');
    div.style.left = x * 28 + "px";
    div.style.top = y * 28 + "px";
    div.className = ((x + y) % 2 ? "d" : "l");
    var div2 = div.cloneNode(), div3 = div.cloneNode();
    div.className += " " + pos.b[x][y];

    var sqeval = 0, sqevalblack = 0;
    if (data[showindex].squares || data[showindex].highlight > 0) {
      try {
        sqeval = func(pos,{x:x,y:y});
        if (data[showindex].forwhite) sqevalblack = func(colorflip(pos),{x:x,y:7-y});
      }
      catch (e) {}    
    }
    if (data[showindex].highlight > 0 && func != null) {
      if (sqeval != 0) div.className += " h1";
       if (data[showindex].highlight > 1 && data[showindex].forwhite) {
        if (sqevalblack != 0) div.className += " h2";
      }
    }
    elem.appendChild(div);
    
    if (data[showindex].squares && func != null) {
      if (data[showindex].squares > 1 || sqeval != 0) {
        div2.className += " h" + ((sqeval >= 1000 || sqeval <= -1000)? " s" : "");
        div2.innerHTML = sqeval; 
      }
      elem2.appendChild(div2);
    }
    if (data[showindex].squares && data[showindex].forwhite && func != null) {
      if (data[showindex].squares > 1 || sqevalblack != 0) {
        div3.className += " h" + ((sqevalblack >= 1000 || sqevalblack <= -1000) ? " s" : "");
        div3.innerHTML = sqevalblack;
      }
      elem3.appendChild(div3);
    }
  }
  document.getElementById('thumb').style.display = data[showindex].eval ? "" : "none";
  var evalInPawns = data[showindex].name == "Main evaluation"
                 || data[showindex].name == "Middle game evaluation"
                 || data[showindex].name == "End game evaluation" ? " (" + (cureval / PAWNVALUE).toFixed(2) + ")" : "";
  var whiteEvalString = data[showindex].name + (data[showindex].forwhite ? " (white)" : "") +  " = <b>" + cureval + evalInPawns+ "</b>";
  var blackEvalString = data[showindex].forwhite ? data[showindex].name +  " (black) = <b>" + curevalflip + "</b><br/>" : "";
  var totalEvalString = data[showindex].forwhite ? data[showindex].name + " (total) = <b>" + (cureval - curevalflip) + "</b>" : "";
  document.getElementById('thumbcaption').innerHTML = whiteEvalString + (data[showindex].forwhite ? "<br/>" : "") + blackEvalString + totalEvalString;
  document.getElementById('thumbcaption2').innerHTML = whiteEvalString;
  document.getElementById('thumbcaption3').innerHTML = blackEvalString;
  document.getElementById('extlinkstitle').style.display = data[showindex].links.length > 0 ? "" : "none";
  document.getElementById('extlinks').innerHTML = "";
  for (var i = 0; i < data[showindex].links.length; i++) {
    var li = document.createElement('li');
    li.innerHTML = '<a class="external" href="'+data[showindex].links[i][0]+'">'+data[showindex].links[i][1]+'</a>';
    document.getElementById('extlinks').appendChild(li);
  }

  document.getElementById("seealso").innerHTML = "";
  // parents
  var nparent = 0,  parentlist = "";
  for (var i = 0; i < data.length; i++) {
    if (data[i].code.indexOf("$"+n2+"(") >= 0) {
      var intxt = "<a onclick=\"golink('"+data[i].name+"');\">" + data[i].name + "</a>";
      document.getElementById("seealso").innerHTML += "<li>" + intxt + "</li>";
      parentlist += (nparent > 0 ? ", " : "") + intxt;
      nparent++;
    }
  }

  // children
  var list = [];
  var text, state = 0, nchild = 0, childlist = "";
  for (var i = 0; i < data[showindex].code.length; i++) {
    var c = data[showindex].code[i].toLowerCase();
    if (state == 0 && c == "$") {
      state = 1;
      text = "";
    } else if (state == 1 && (c >= "a" && c <= "z" || c >= "0" && c <= "9" || c == "_")) text += c;
    else if (state == 1) {
      if (text.length > 0 && list.indexOf(text) < 0) list.push(text);
      state = 0;
    }
  }
  for (var i = 0; i < list.length; i++) {
    var n = list[i][0].toUpperCase() + list[i].replace(/_/g, " ").substring(1).toLowerCase();
    var intxt = "<a onclick=\"golink('"+n+"');\">" + n + "</a>";
    childlist += (nchild > 0 ? ", " : "") + intxt;
    document.getElementById("seealso").innerHTML += "<li>" + intxt + "</li>";
    nchild++;
  }  
  document.getElementById('seealsotitle').style.display = nchild + nparent > 0 ? "" : "none";
  document.getElementById("childlist").innerHTML = nchild == 0 ? "This function calls no evaluation subterms." : "This function calls following evaluation subterms: " + childlist;
  document.getElementById("parentlist").innerHTML = nparent == 0 ? "It is used in no parent evaluation terms." : "It is used in following parent evaluation terms: " + parentlist;
  if (document.getElementById('bodyContentTable').style.display == "") refreshTable(pos);
  if (document.getElementById('bodyContentGraph').style.display == "") refreshGraph(pos);
}

function bounds(x, y) {
  return x >= 0 && x <= 7 && y >= 0 && y <= 7;
}
function board(pos, x, y) {
  if (x >= 0 && x <= 7 && y >= 0 && y <= 7) return pos.b[x][y];
  return "x";
}
function colorflip(pos) {
  var board = new Array(8);
  for (var i = 0; i < 8; i++) board[i] = new Array(8);
  for (x = 0; x < 8; x++) for (y = 0; y < 8; y++) {
    board[x][y] = pos.b[x][7-y];
    var color = board[x][y].toUpperCase() == board[x][y];
    board[x][y] = color ? board[x][y].toLowerCase() : board[x][y].toUpperCase();
  }
  return {b:board, c:[pos.c[2],pos.c[3],pos.c[0],pos.c[1]], e:pos.e == null ? null : [pos.e[0],7-pos.e[1]], w:!pos.w, m:[pos.m[0],pos.m[1]]};
}
function sum(pos, func, param) {
  var sum = 0;
  for (var x = 0; x < 8; x++) for(var y = 0; y < 8; y++) sum += func(pos, {x:x, y:y}, param);
  return sum;
}

function parseFEN(fen) {
  var board = new Array(8);
  for (var i = 0; i < 8; i++) board[i] = new Array(8);
  var a = fen.replace(/^\s+/,'').split(' '), s = a[0], x, y;
  for (x = 0; x < 8; x++) for (y = 0; y < 8; y++) {
    board[x][y] = '-';
  }
  x = 0, y = 0;
  for (var i = 0; i < s.length; i++) {
    if (s[i] == ' ') break;
    if (s[i] == '/') {
      x = 0;
      y++;
    } else {
      if (!bounds(x, y)) continue;
      if ('KQRBNP'.indexOf(s[i].toUpperCase()) != -1) {
        board[x][y] = s[i];
        x++;
      } else if ('0123456789'.indexOf(s[i]) != -1) {
        x += parseInt(s[i]);
      } else x++;
    }
  }
  var castling, enpassant, whitemove = !(a.length > 1 && a[1] == 'b');  
  if (a.length > 2) {
    castling = [ a[2].indexOf('K') != -1, a[2].indexOf('Q') != -1,
                 a[2].indexOf('k') != -1, a[2].indexOf('q') != -1];
  } else {
    castling = [ true, true, true, true ];
  }
  if (a.length > 3 && a[3].length == 2) {
    var ex = 'abcdefgh'.indexOf(a[3][0]);
    var ey = '87654321'.indexOf(a[3][1]);
    enpassant = (ex >= 0 && ey >= 0) ? [ex, ey] : null;
  } else {
    enpassant = null;
  }
  var movecount = [(a.length > 4 && !isNaN(a[4]) && a[4] != '') ? parseInt(a[4]) : 0,
                   (a.length > 5 && !isNaN(a[5]) && a[5] != '') ? parseInt(a[5]) : 1];
  return {b:board, c:castling, e:enpassant, w:whitemove, m:movecount};
}

function generateFEN(pos) {
  var s = '', f = 0, castling = pos.c, enpassant = pos.e, board = pos.b;
  for (var y = 0; y < 8; y++) {
    for (var x = 0; x < 8; x++) {
      if (board[x][y] == '-') {
        f++;
      } else {
        if (f > 0) s += f, f = 0;
        s += board[x][y];
      }
    }
    if (f > 0) s += f, f = 0;
    if (y < 7) s += '/';
  }
  s += ' ' + (pos.w ? 'w' : 'b')
     + ' ' + ((castling[0] || castling[1] || castling[2] || castling[3])
           ? ((castling[0] ? 'K' : '') + (castling[1] ? 'Q' : '') +
             (castling[2] ? 'k' : '') + (castling[3] ? 'q' : ''))
           : '-')
     + ' ' + (enpassant == null ? '-' : ('abcdefgh'[enpassant[0]] + '87654321'[enpassant[1]]))
     + ' ' + pos.m[0] + ' ' + pos.m[1];
  return s;
}

function isWhiteCheck(pos) {
  var kx = null, ky = null;
  for (var x = 0; x < 8; x++) {
    for (var y = 0; y < 8; y++) {
      if (pos.b[x][y] == 'K') { kx = x; ky = y; }
    }
  }
  if (kx == null || ky == null) return false;
  if (  board(pos, kx + 1, ky - 1) == 'p'
     || board(pos, kx - 1, ky - 1) == 'p'
     || board(pos, kx + 2, ky + 1) == 'n'
     || board(pos, kx + 2, ky - 1) == 'n'
     || board(pos, kx + 1, ky + 2) == 'n'
     || board(pos, kx + 1, ky - 2) == 'n'
     || board(pos, kx - 2, ky + 1) == 'n'
     || board(pos, kx - 2, ky - 1) == 'n'
     || board(pos, kx - 1, ky + 2) == 'n'
     || board(pos, kx - 1, ky - 2) == 'n'
     || board(pos, kx - 1, ky - 1) == 'k'
     || board(pos, kx    , ky - 1) == 'k'
     || board(pos, kx + 1, ky - 1) == 'k'
     || board(pos, kx - 1, ky    ) == 'k'
     || board(pos, kx + 1, ky    ) == 'k'
     || board(pos, kx - 1, ky + 1) == 'k'
     || board(pos, kx    , ky + 1) == 'k'
     || board(pos, kx - 1, ky + 1) == 'k') return true; 
  for (var i = 0; i < 8; i++) {
    var ix = (i + (i > 3)) % 3 - 1;
    var iy = (((i + (i > 3)) / 3) << 0) - 1;
    for (var d = 1; d < 8; d++) {
      var b = board(pos, kx + d * ix, ky + d * iy);
      var line = ix == 0 || iy == 0;
      if (b == 'q' || b == 'r' && line || b == 'b' && !line) return true;
      if (b != "-") break;
    }
  }
  return false;
}
function doMove(pos, from, to, promotion) {
  if (pos.b[from.x][from.y].toUpperCase() != pos.b[from.x][from.y]) {
    var r = colorflip(doMove(colorflip(pos),{x:from.x,y:7-from.y}, {x:to.x,y:7-to.y}, promotion));
    r.m[1]++;
    return r;
  }
  var r = colorflip(colorflip(pos));
  r.w = !r.w;
  if (from.x == 7 && from.y == 7 || to.x == 7 && to.y == 7) r.c[0] = false;
  if (from.x == 0 && from.y == 7 || to.x == 0 && to.y == 7) r.c[1] = false;
  if (from.x == 4 && from.y == 7 || to.x == 4 && to.y == 7) r.c[0] = r.c[1] = false;
  r.e = pos.b[from.x][from.y] == 'P' && from.y == 6 && to.y == 4 ? [from.x, 5] : null;
  if (pos.b[from.x][from.y] == 'K') {
    if (Math.abs(from.x - to.x) > 1) {
      r.b[from.x][from.y] = '-';
      r.b[to.x][to.y] = 'K';
      r.b[to.x > 4 ? 5 : 3][to.y] = 'R';
      r.b[to.x > 4 ? 7 : 0][to.y] = '-';
      return r;
    }
  }
  if (pos.b[from.x][from.y] == 'P' && to.y == 0) {
    r.b[to.x][to.y] = promotion != null ? promotion : 'Q';
  } else if (pos.b[from.x][from.y] == 'P'
          && pos.e != null && to.x == pos.e[0] && to.y == pos.e[1]
          && Math.abs(from.x - to.x) == 1) {
    r.b[to.x][from.y] = '-';
    r.b[to.x][to.y] = pos.b[from.x][from.y];
    
  } else {
    r.b[to.x][to.y] = pos.b[from.x][from.y];
  }
  r.b[from.x][from.y] = '-';
  r.m[0] = (pos.b[from.x][from.y] == 'P' || pos.b[to.x][to.y] != '-') ? 0 : r.m[0] + 1;
  return r;
}
function isLegal(pos, from, to) {
  if (!bounds(from.x, from.y)) return false;
  if (!bounds(to.x, to.y)) return false;
  if (from.x == to.x && from.y == to.y) return false;
  if (pos.b[from.x][from.y] != pos.b[from.x][from.y].toUpperCase()) {
    return isLegal(colorflip(pos), {x:from.x,y:7-from.y}, {x:to.x,y:7-to.y})
  }
  if (!pos.w) return false;
  var pfrom = pos.b[from.x][from.y];
  var pto = pos.b[to.x][to.y];
  if (pto.toUpperCase() == pto && pto != '-') return false;
  if (pfrom == '-') {
    return false;
  } else if (pfrom == 'P') {
    var enpassant = pos.e != null && to.x == pos.e[0] && to.y == pos.e[1];
    if (!((from.x == to.x && from.y == to.y + 1 && pto == '-')
       || (from.x == to.x && from.y == 6 && to.y == 4 && pto== '-' && pos.b[to.x][5] == '-')
       || (Math.abs(from.x - to.x) == 1 && from.y == to.y + 1 && (pto != '-' || enpassant))
       )) return false;
  } else if (pfrom == 'N') {
    if (Math.abs(from.x - to.x) < 1 || Math.abs(from.x - to.x) > 2) return false;
    if (Math.abs(from.y - to.y) < 1 || Math.abs(from.y - to.y) > 2) return false;
    if (Math.abs(from.x - to.x) + Math.abs(from.y - to.y) != 3) return false;
  } else if (pfrom == 'K') {
    var castling = true;
    if (from.y != 7 || to.y != 7) castling = false;
    if (from.x != 4 || (to.x != 2 && to.x != 6)) castling = false;
    if (to.x == 6 && !pos.c[0] || to.x == 2 && !pos.c[1]) castling = false;
    if (to.x == 2 && pos.b[0][7]+pos.b[1][7]+pos.b[2][7]+pos.b[3][7] != 'R---') castling = false;
    if (to.x == 6 && pos.b[5][7]+pos.b[6][7]+pos.b[7][7] != '--R') castling = false;
    if ((Math.abs(from.x - to.x) > 1 || Math.abs(from.y - to.y) > 1) && !castling) return false;
    if (castling && isWhiteCheck(pos)) return false;
    if (castling && isWhiteCheck(doMove(pos,from,{x:to.x == 2 ? 3 : 5,y:7}))) return false;
  }
  if (pfrom == 'B' || pfrom == 'R' || pfrom == 'Q') {
    var a = from.x - to.x, b = from.y - to.y;
    var line = a == 0 || b == 0;
    var diag = Math.abs(a) == Math.abs(b);
    if (!line && !diag) return false;
    if (pfrom == 'R' && !line) return false;
    if (pfrom == 'B' && !diag) return false;
    var count = Math.max(Math.abs(a), Math.abs(b));
    var ix = a > 0 ? -1 : a < 0 ? 1 : 0, iy = b > 0 ? -1 : b < 0 ? 1 : 0;
    for (var i = 1; i < count; i++) {
      if (pos.b[from.x+ix*i][from.y+iy*i] != '-') return false;
    }
  }
  if (isWhiteCheck(doMove(pos, from, to))) return false;
  return true;
}
function parseMove(pos, s) {
  var promotion = null;
  s = s.replace(/[\+|#|\?|!|x]/g,"");
  if (s.length >= 2 && s[s.length - 2] == "=") {
    promotion = s[s.length - 1]
    s = s.substring(0, s.length - 2);
  }
  if (s == "O-O" || s == "O-O-O") {
    var from = {x:4,y:pos.w?7:0}, to = {x:s=="O-O"?6:2,y:pos.w?7:0};
    if (isLegal(pos, from, to)) return {from:from, to:to}; else return null;
  } else {
    var p;
    if ("PNBRQK".indexOf(s[0]) < 0) {
      p = "P";
    } else {
      p = s[0];
      s = s.substring(1);
    }
    if (s.length < 2 || s.length > 4) return null;
    var xto = "abcdefgh".indexOf(s[s.length-2]);
    var yto = "87654321".indexOf(s[s.length-1]);
    var xfrom = -1, yfrom = -1;
    if (s.length > 2) {
      xfrom = "abcdefgh".indexOf(s[0]);
      yfrom = "87654321".indexOf(s[s.length-3]);
    }
    for (var x = 0; x < 8; x++) {
      for (var y = 0; y < 8; y++) {
        if (xfrom != -1 && xfrom != x) continue;
        if (yfrom != -1 && yfrom != y) continue;
        if (pos.b[x][y] == (pos.w ? p : p.toLowerCase()) && isLegal(pos, {x:x,y:y}, {x:xto,y:yto})) {
          xfrom = x;
          yfrom = y;
        }
      }
    }
    if (xto < 0 || yto < 0 || xfrom < 0 || yfrom < 0) return null;
    return {from:{x:xfrom,y:yfrom},to:{x:xto,y:yto},p:promotion};
  }
}

var _history = [], _historyindex = -1;
function historybuttons() {
  document.getElementById('buttonback').className = _historyindex > 0 ? "on" : "off";
  document.getElementById('buttonforward').className = _historyindex < _history.length - 1 ? "on" : "off";
  document.getElementById('buttonback').innerHTML = "&#9668;";
  document.getElementById('buttonforward').innerHTML = "&#9658;";
}
function historyadd(fen) {
  if (_historyindex >= 0 && _history[_historyindex] == fen) return;
  _historyindex++;
  _history.length = _historyindex;
  _history.push(fen);
  historybuttons();
}
function historymove(v, e) {
  if (e == null) e = window.event;
  if (_historyindex == _history.length - 1
   && _history[_historyindex] != document.getElementById('fen').innerHTML) historyadd(document.getElementById('fen').innerHTML);
  if (_historyindex + v >= 0 && _historyindex + v < _history.length) _historyindex += v;
  if (e != null && e.ctrlKey && Math.abs(v) == 1) _historyindex = v == 1 ? _history.length - 1 : 0;
  document.getElementById('fen').innerHTML = _history[_historyindex];
  historybuttons();
  showBoard();
}

var _dragElement = null, _dragActive = false, _startX, _startY, _dragCtrl, _longPressTimer = null;
function onMouseDown(e, button) {
  clearTimeout(_longPressTimer);
  _longPressTimer = window.setTimeout(function() { dragActivate(); _longPressTimer = null; }, 1000);
  if (_dragElement != null) return true;
  if (e == null) e = window.event;
  var elem = target = e.target != null ? e.target : e.srcElement;
  while (target != null && target.id != 'chessboard1' && target.tagName != 'BODY') {
    target = target.parentNode;
  }
  if (target == null) return true;
  if (target.id != 'chessboard1') return true;
  if (elem.className[2] == '-') return true;
  document.onmousemove = onMouseMove;
  document.body.focus();
  document.onselectstart = function () { return false; };
  elem.ondragstart = function () { return false; };
  _dragActive = false;
  _dragCtrl = e.ctrlKey;
  _dragElement = elem;
  _startX = e.clientX;
  _startY = e.clientY;
  return false;

}

function dragActivate() {
    clearTimeout(_longPressTimer);
    if (_dragElement == null) return;
    var clone = _dragElement.cloneNode();
    if (!_dragCtrl) _dragElement.className = _dragElement.className[0] + " -";
    _dragElement = clone;
    _dragElement.className = _dragElement.className.substring(0, 3);
    _dragElement.style.backgroundColor = "transparent";
    _dragElement.style.zIndex = 10000;
    document.getElementById('chessboard1').appendChild(_dragElement);
    _dragActive = true;
    
    var w = _dragElement.getBoundingClientRect().width;
    var h = _dragElement.getBoundingClientRect().height;
    var offsetX = document.getElementById('chessboard1').getBoundingClientRect().left + w / 2;
    var offsetY = document.getElementById('chessboard1').getBoundingClientRect().top + h / 2;
    var x1 = Math.round((_startX - offsetX) / w);
    var y1 = Math.round((_startY - offsetY) / h);    
    showLegalMoves({x:x1,y:y1});
}

function onMouseMove(e) {
  if (_dragElement == null) return;
  if (e == null) e = window.event;
  if (!_dragActive) {
    if (Math.abs(e.clientX - _startX) < 4 && Math.abs(e.clientY - _startY) < 4) return;
    dragActivate();
  }
  var offsetX = document.getElementById('chessboard1').getBoundingClientRect().left + _dragElement.getBoundingClientRect().width / 2;
  var offsetY = document.getElementById('chessboard1').getBoundingClientRect().top + _dragElement.getBoundingClientRect().height / 2;
  _dragElement.style.left = (e.clientX - offsetX) + 'px';
  _dragElement.style.top = (e.clientY - offsetY) + 'px';
}

function onMouseUp(e) {
  onMouseMove(e);
  if (_longPressTimer) {
    clearTimeout(_longPressTimer);
  } else if (_dragElement != null) return false;
  if (_dragElement != null) {
    if (_dragActive) {
      var w = _dragElement.getBoundingClientRect().width;
      var h = _dragElement.getBoundingClientRect().height;
      var offsetX = document.getElementById('chessboard1').getBoundingClientRect().left + w / 2;
      var offsetY = document.getElementById('chessboard1').getBoundingClientRect().top + h / 2;
      var x1 = Math.round((_startX - offsetX) / w);
      var y1 = Math.round((_startY - offsetY) / h);
      var x2 = Math.round((e.clientX - offsetX) / w);
      var y2 = Math.round((e.clientY - offsetY) / h);
      
      var pos = parseFEN(document.getElementById('fen').innerHTML);
      var legal = !_dragCtrl && isLegal(pos,{x:x1,y:y1},{x:x2,y:y2});
      if (legal) {
        pos = doMove(pos,{x:x1,y:y1},{x:x2,y:y2});
      } else {
        if (bounds(x2, y2)) pos.b[x2][y2] = pos.b[x1][y1];
        if (!_dragCtrl && (x1 != x2 || y1 != y2)) pos.b[x1][y1] = '-';
      }
      historyadd(document.getElementById('fen').innerHTML);
      document.getElementById('fen').innerHTML = generateFEN(pos);
      historyadd(document.getElementById('fen').innerHTML);
      showBoard();
    }

    document.onmousemove = null;
    document.onselectstart = null;
    _dragElement = null;
    return false;
  }
}

var timer, special = null;
function chessboardOnDblClick(e) {
  if (e == null) e = window.event;
  var elem = target = e.target != null ? e.target : e.srcElement;

  var w = elem.getBoundingClientRect().width;
  var h = elem.getBoundingClientRect().height;
  var offsetX = document.getElementById('chessboard1').getBoundingClientRect().left + w / 2;
  var offsetY = document.getElementById('chessboard1').getBoundingClientRect().top + h / 2;
  var x1 = Math.round((e.clientX - offsetX) / w);
  var y1 = Math.round((e.clientY - offsetY) / h);  
  var pos = parseFEN(document.getElementById('fen').innerHTML);
  if (bounds(x1, y1)) {
    var s = '-PNBRQKpnbrqk-', index = s.indexOf(pos.b[x1][y1]);
    if (e.ctrlKey) index = index >= 1 && index <= 6 ? index + 6 : (index > 6 ? index - 6 : index); else index++;
    pos.b[x1][y1] = s[index];
  }
  document.getElementById('fen').innerHTML = generateFEN(pos);
  showBoard();
  
  document.getElementById('chessboard1').onclick = chessboardOnDblClick;
  if (timer) window.clearTimeout(timer);
  timer = window.setTimeout(function() { document.getElementById('chessboard1').onclick = null; }, 1000);
}

window.onload = function () {
  showMenu();
  doEval();
  curindex = 0;
  updatePage();
  editmode(0);
  historyadd(document.getElementById('fen').innerHTML);
  command(getParameterByName("p"));
  document.onmousedown = onMouseDown;
  document.onmouseup = onMouseUp;
  document.getElementById('chessboard1').ondblclick = chessboardOnDblClick;
}
</script>
<script id="loadData">var data = [], curindex = null;
data.push({"name":"Main evaluation","group":"","text":"<b>$</b>. An evaluation function is used to heuristically determine the relative value of a positions used in general case when no specialized evaluation or tablebase evaluation is available. In Stockfish it is never applied for positions where king of either side is in check. Resulting value is computed by combining [[Middle game evaluation]] and [[End game evaluation]]. We use <a class=\"external\" href=\"https://www.chessprogramming.org/Tapered_Eval\">Tapered Eval</a>, a technique used in evaluation to make a smooth transition between the phases of the game. [[Phase]] is a coeficient of simple linear combination. Before using  [[End game evaluation]] in this formula we also scale it down using [[Scale factor]].","code":"function $$(pos) {\n  var mg = $middle_game_evaluation(pos);\n  var eg = $end_game_evaluation(pos);\n  var p = $phase(pos), rule50 = pos.m[0];\n  eg = eg * $scale_factor(pos, eg) / 64;\n  var v = (((mg * p + ((eg * (128 - p)) << 0)) / 128) << 0);\n  v = ((v / 16) << 0) * 16;\n  v += $tempo(pos);\n  v = (v * (100 - rule50) / 100) << 0;\n  return v;\n}","links":[["https://www.chessprogramming.org/Evaluation","Evaluation in cpw"],["https://www.chessprogramming.org/Tapered_Eval","Tapered Eval in cpw"],["https://www.chessprogramming.org/Game_Phases","Game Phases in cpw"],["https://www.chessprogramming.org/Tempo","Tempo in cpw"]],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"Isolated","group":"Pawns","text":"<b>$</b> checks if pawn is isolated. In chess, an isolated pawn is a pawn which has no friendly pawn on an adjacent file.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  for (var y = 0 ; y < 8; y++) {\n    if (board(pos, square.x - 1, y) == \"P\") return 0;\n    if (board(pos, square.x + 1, y) == \"P\") return 0;\n  }\n  return 1;\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"14.8","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a7b374d0ebc5902971a9a58"}});
data.push({"name":"Opposed","group":"Pawns","text":"<b>$</b> flag is set if there is opponent opposing pawn on the same file to prevent it from advancing.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  for (var y = 0; y < square.y; y++) {\n    if (board(pos, square.x, y) == \"p\") return 1;\n  }\n  return 0;\n}","links":[["https://www.chessprogramming.org/Evaluation","Evaluation"],["https://www.chessprogramming.org/Tapered_Eval","Tapered Eval"],["https://www.chessprogramming.org/Game_Phases","Game Phases"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Rank","group":"Helpers","text":"<b>$</b> calculates rank of square.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return 8 - square.y;\n}","links":[],"eval":true,"squares":2,"highlight":0,"forwhite":true});
data.push({"name":"File","group":"Helpers","text":"<b>$</b> calculates file of square.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return 1 + square.x;\n}","links":[],"eval":true,"squares":2,"highlight":0,"forwhite":true});
data.push({"name":"Phalanx","group":"Pawns","text":"<b>$</b> flag is set if there is friendly pawn on adjacent file and same rank.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if (board(pos, square.x - 1, square.y) == \"P\") return 1;\n  if (board(pos, square.x + 1, square.y) == \"P\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Supported","group":"Pawns","text":"<b>$</b> counts number of pawns supporting this pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  return (board(pos, square.x - 1, square.y + 1) == \"P\" ? 1 : 0)\n       + (board(pos, square.x + 1, square.y + 1) == \"P\" ? 1 : 0);\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Backward","group":"Pawns","text":"A pawn is <b>$</b> when it is behind all pawns of the same color on the adjacent files and cannot be safely advanced.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  for (var y = square.y; y < 8; y++) {\n    if (board(pos, square.x - 1, y) == \"P\"\n     || board(pos, square.x + 1, y) == \"P\") return 0;\n  }\n  if (board(pos, square.x - 1, square.y - 2) == \"p\"\n   || board(pos, square.x + 1, square.y - 2) == \"p\"\n   || board(pos, square.x    , square.y - 1) == \"p\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Doubled","group":"Pawns","text":"<b>$</b> checks if pawn is doubled. In chess, an doubled pawn is a pawn which has another friendly pawn on same file but in Stockfish we attach doubled pawn penalty only for pawn which has another friendly pawn on square directly behind that pawn and is not supported.\n\n","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if (board(pos, square.x, square.y + 1) != \"P\") return 0;\n  if (board(pos, square.x - 1, square.y + 1) == \"P\") return 0;\n  if (board(pos, square.x + 1, square.y + 1) == \"P\") return 0;\n  return 1;\n}","links":[["https://en.wikipedia.org/wiki/Doubled_pawn","Doubled pawn"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"2.25","error":"2.9","link":"http://tests.stockfishchess.org/tests/view/5acf80740ebc59547e5380fe"}});
data.push({"name":"Connected","group":"Pawns","text":"<b>$</b> checks if pawn is [[Supported]] or [[Phalanx]].","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($supported(pos, square) || $phalanx(pos, square)) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"29.34","error":"4.4","link":"http://tests.stockfishchess.org/tests/view/5a7a1ab60ebc5902971a99ed"}});
data.push({"name":"Middle game evaluation","group":"","text":"<b>$</b>. Evaluates position for the middlegame and the opening phases.","code":"function $$(pos, nowinnable) {\n  var v = 0;\n  v += $piece_value_mg(pos) - $piece_value_mg(colorflip(pos));\n  v += $psqt_mg(pos) - $psqt_mg(colorflip(pos));\n  v += $imbalance_total(pos);\n  v += $pawns_mg(pos) - $pawns_mg(colorflip(pos));\n  v += $pieces_mg(pos) - $pieces_mg(colorflip(pos));\n  v += $mobility_mg(pos) - $mobility_mg(colorflip(pos));\n  v += $threats_mg(pos) - $threats_mg(colorflip(pos));\n  v += $passed_mg(pos) - $passed_mg(colorflip(pos));\n  v += $space(pos) - $space(colorflip(pos));\n  v += $king_mg(pos) - $king_mg(colorflip(pos));\n  if (!nowinnable) v += $winnable_total_mg(pos, v);\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"End game evaluation","group":"","text":"<b>$</b>. Evaluates position for the endgame phase.","code":"function $$(pos, nowinnable) {\n  var v = 0;\n  v += $piece_value_eg(pos) - $piece_value_eg(colorflip(pos));\n  v += $psqt_eg(pos) - $psqt_eg(colorflip(pos));\n  v += $imbalance_total(pos);\n  v += $pawns_eg(pos) - $pawns_eg(colorflip(pos));\n  v += $pieces_eg(pos) - $pieces_eg(colorflip(pos));\n  v += $mobility_eg(pos) - $mobility_eg(colorflip(pos));\n  v += $threats_eg(pos) - $threats_eg(colorflip(pos));\n  v += $passed_eg(pos) - $passed_eg(colorflip(pos));\n  v += $king_eg(pos) - $king_eg(colorflip(pos));\n  if (!nowinnable) v += $winnable_total_eg(pos, v);\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"Scale factor","group":"","text":"<b>$</b>. The scale factors are used to scale the endgame evaluation score down.","code":"function $$(pos, eg) {\n  if (eg == null) eg = $end_game_evaluation(pos);\n  var pos2 = colorflip(pos);\n  var pos_w = eg > 0 ? pos : pos2;\n  var pos_b = eg > 0 ? pos2 : pos;\n  var sf = 64;\n  var pc_w = $pawn_count(pos_w), pc_b = $pawn_count(pos_b);\n  var qc_w = $queen_count(pos_w), qc_b = $queen_count(pos_b);\n  var bc_w = $bishop_count(pos_w), bc_b = $bishop_count(pos_b);\n  var nc_w = $knight_count(pos_w), nc_b = $knight_count(pos_b);\n  var npm_w = $non_pawn_material(pos_w), npm_b = $non_pawn_material(pos_b);\n  var bishopValueMg = 825, bishopValueEg = 915, rookValueMg = 1276;\n  if (pc_w == 0 && npm_w - npm_b <= bishopValueMg) sf = npm_w < rookValueMg ? 0 : npm_b <= bishopValueMg ? 4 : 14;\n  if (sf == 64) {\n    var ob = $opposite_bishops(pos);\n    if (ob && npm_w == bishopValueMg && npm_b == bishopValueMg) {\n      sf = 22 + 4 * $candidate_passed(pos_w);\n    } else if (ob) {\n      sf = 22 + 3 * $piece_count(pos_w);\n    } else {\n      if (npm_w == rookValueMg && npm_b == rookValueMg && pc_w - pc_b <= 1) {\n        var pawnking_b = 0, pcw_flank = [0, 0];\n        for (var x = 0; x < 8; x++) {\n          for (var y = 0; y < 8; y++) {\n            if (board(pos_w, x, y) == \"P\") pcw_flank[(x < 4)?1:0] = 1;\n            if (board(pos_b, x, y) == \"K\") {\n              for (var ix = -1; ix <= 1; ix++) {\n                for (var iy = -1; iy <= 1; iy++) {\n                  if (board(pos_b, x + ix, y + iy) == \"P\") pawnking_b = 1;\n                }\n              }\n            }\n          }\n        }\n        if (pcw_flank[0] != pcw_flank[1] && pawnking_b) return 36;\n      }\n      if (qc_w + qc_b == 1) {\n        sf = 37 + 3 * (qc_w == 1 ? bc_b + nc_b : bc_w + nc_w);\n      } else {\n        sf = Math.min(sf, 36 + 7 * pc_w);\n      }\n    }\n  }\n  return sf;\n}","links":[["https://www.chessprogramming.org/Bishops_of_Opposite_Colors","Bishops of Opposite Colors in cpw"]],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Phase","group":"","text":"<b>$</b>. We define phase value for tapered eval based on the amount of non-pawn material on the board.","code":"function $$(pos) {\n  var midgameLimit = 15258, endgameLimit  = 3915;\n  var npm = $non_pawn_material(pos) + $non_pawn_material(colorflip(pos));\n  npm = Math.max(endgameLimit, Math.min(npm, midgameLimit));\n  return (((npm - endgameLimit) * 128) / (midgameLimit - endgameLimit)) << 0;\n}","links":[["https://www.chessprogramming.org/Game_Phases","Game Phases in cpw"],["https://www.chessprogramming.org/Tapered_Eval","Tapered Eval in cpw"]],"eval":true,"squares":0,"highlight":0,"forwhite":false});
data.push({"name":"Imbalance","group":"Imbalance","text":"<b>$</b> calculates the imbalance by comparing the piece count of each piece type for both colors. Evaluate the material imbalance. We use a place holder for the bishop pair \"extended piece\", which allows us to be more flexible in defining bishop pair bonuses.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var qo = [[0],[40,38],[32,255,-62],[0,104,4,0],[-26,-2,47,105,-208],[-189,24,117,133,-134,-6]];\n  var qt = [[0],[36,0],[9,63,0],[59,65,42,0],[46,39,24,-24,0],[97,100,-42,137,268,0]];\n  var j = \"XPNBRQxpnbrq\".indexOf(board(pos, square.x, square.y));\n  if (j < 0 || j > 5) return 0;\n  var bishop = [0, 0], v = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      var i = \"XPNBRQxpnbrq\".indexOf(board(pos, x, y));\n      if (i < 0) continue;\n      if (i == 9) bishop[0]++;\n      if (i == 3) bishop[1]++;\n      if (i % 6 > j) continue;\n      if (i > 5) v += qt[j][i-6];\n            else v += qo[j][i];\n    }\n  }\n  if (bishop[0] > 1) v += qt[j][0];\n  if (bishop[1] > 1) v += qo[j][0];\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Bishop count","group":"Helpers","text":"<b>$</b> counts number of our bishops.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"B\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Bishop pair","group":"Imbalance","text":"<b>$</b>. The player with two bishops is said to have the bishop pair.","code":"function $$(pos, square) {\n  if ($bishop_count(pos) < 2) return 0;\n  if (square == null) return 1438;\n  return board(pos, square.x, square.y) == \"B\" ? 1 : 0;\n}","links":[["https://www.chessprogramming.org/Bishop_Pair","Bishop Pair on cpw"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Pinned direction","group":"Attack","text":"<b>$</b>. Helper function for detecting blockers for king. For our pinned pieces result is positive for enemy blockers negative and value encodes direction of pin. 1 - horizontal, 2 - topleft to bottomright, 3 - vertical, 4 - topright to bottomleft","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"PNBRQK\".indexOf(board(pos, square.x, square.y).toUpperCase()) < 0) return 0;\n  var color = 1;\n  if (\"PNBRQK\".indexOf(board(pos, square.x, square.y)) < 0) color = -1;\n  for (var i = 0; i < 8; i++) {\n    var ix = (i + (i > 3)) % 3 - 1;\n    var iy = (((i + (i > 3)) / 3) << 0) - 1;\n    var king = false;\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"K\") king = true;\n      if (b != \"-\") break;\n    }\n    if (king) {\n      for (var d = 1; d < 8; d++) {\n        var b = board(pos, square.x - d * ix, square.y - d * iy);\n        if (b == \"q\"\n         || b == \"b\" && ix * iy != 0\n         || b == \"r\" && ix * iy == 0) return Math.abs(ix + iy * 3) * color;\n        if (b != \"-\") break;\n      }\n    }\n  }\n  return 0;\n}","links":[["https://en.wikipedia.org/wiki/Pin_(chess)","Pin in wikipedia"],["https://www.chessprogramming.org/Pin","Pin in cpw"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Mobility","group":"Mobility","text":"<b>$</b>. Number of attacked squares in the [[Mobility area]]. For queen squares defended by opponent knight, bishop or rook are ignored. For minor pieces squares occupied by our  queen are ignored.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;  \n  var b = board(pos, square.x, square.y);\n  if (\"NBRQ\".indexOf(b) < 0) return 0;\n  for (var x = 0; x < 8; x++) {\n    for(var y = 0; y < 8; y++) {\n      var s2 = {x:x, y:y};\n      if (!$mobility_area(pos, s2)) continue;\n      if (b == \"N\" && $knight_attack(pos, s2, square) && board(pos, x, y) != 'Q') v++;\n      if (b == \"B\" && $bishop_xray_attack(pos, s2, square) && board(pos, x, y) != 'Q') v++;\n      if (b == \"R\" && $rook_xray_attack(pos, s2, square)) v++;\n      if (b == \"Q\" && $queen_attack(pos, s2, square)) v++;\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Mobility area","group":"Mobility","text":"<b>$</b>. Do not include in mobility area squares protected by enemy pawns, or occupied by our blocked pawns or king. Pawns blocked or on ranks 2 and 3 will be excluded from the mobility area. Also excludes blockers for king from mobility area - blockers for king can't really move until king moves (in most cases) so logic behind it is the same as behind excluding king square from mobility area.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"K\") return 0;\n  if (board(pos, square.x, square.y) == \"Q\") return 0;\n  if (board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x + 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x, square.y) == \"P\" &&\n     ($rank(pos, square) < 4 || board(pos, square.x, square.y - 1) != \"-\")) return 0;\n  if ($blockers_for_king(colorflip(pos), {x:square.x,y:7-square.y})) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Mobility bonus","group":"Mobility","text":"<b>$</b> attach bonuses for middlegame and endgame by piece type and [[Mobility]].","code":"function $$(pos, square, mg) {\n  if (square == null) return sum(pos, $$, mg);\n  var bonus = mg ? [\n    [-62,-53,-12,-4,3,13,22,28,33],\n    [-48,-20,16,26,38,51,55,63,63,68,81,81,91,98],\n    [-60,-20,2,3,3,11,22,31,40,40,41,48,57,57,62],\n    [-30,-12,-8,-9,20,23,23,35,38,53,64,65,65,66,67,67,72,72,77,79,93,108,108,108,110,114,114,116]\n  ] : [\n    [-81,-56,-31,-16,5,11,17,20,25],\n    [-59,-23,-3,13,24,42,54,57,65,73,78,86,88,97],\n    [-78,-17,23,39,70,99,103,121,134,139,158,164,168,169,172],\n    [-48,-30,-7,19,40,55,59,75,78,96,96,100,121,127,131,133,136,141,147,150,151,168,168,171,182,182,192,219]\n  ];\n  var i = \"NBRQ\".indexOf(board(pos, square.x, square.y));\n  if (i < 0) return 0;\n  return bonus[i][$mobility(pos, square)];\n}","links":[],"eval":false,"squares":0,"highlight":0,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Knight attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by knight.","code":"function $$(pos, square, s2) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  for (var i = 0; i < 8; i++) {\n    var ix = ((i > 3) + 1) * (((i % 4) > 1) * 2 - 1);\n    var iy = (2 - (i > 3)) * ((i % 2 == 0) * 2 - 1);\n    var b = board(pos, square.x + ix, square.y + iy);\n    if (b == \"N\"\n    && (s2 == null || s2.x == square.x + ix && s2.y == square.y + iy)\n    && !$pinned(pos, {x:square.x + ix, y:square.y + iy})) v++;\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Bishop xray attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by bishop. Includes x-ray attack through queens.","code":"function $$(pos, square, s2) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  for (var i = 0; i < 4; i++) {\n    var ix = ((i > 1) * 2 - 1);\n    var iy = ((i % 2 == 0) * 2 - 1);\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"B\"\n      && (s2 == null || s2.x == square.x + d * ix && s2.y == square.y + d * iy)) {\n        var dir = $pinned_direction(pos, {x:square.x+d*ix, y:square.y+d*iy});\n        if (dir == 0 || Math.abs(ix+iy*3) == dir) v++;\n      }\n      if (b != \"-\" && b != \"Q\" && b != \"q\") break;\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Rook xray attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by rook. Includes x-ray attack through queens and our rook.","code":"function $$(pos, square, s2) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  for (var i = 0; i < 4; i++) {\n    var ix = (i == 0 ? -1 : i == 1 ? 1 : 0);\n    var iy = (i == 2 ? -1 : i == 3 ? 1 : 0);\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"R\"\n      && (s2 == null || s2.x == square.x + d * ix && s2.y == square.y + d * iy)) {\n        var dir = $pinned_direction(pos, {x:square.x+d*ix, y:square.y+d*iy});\n        if (dir == 0 || Math.abs(ix+iy*3) == dir) v++;\n      }\n      if (b != \"-\" && b != \"R\" && b != \"Q\" && b != \"q\") break;\n    }\n  }\n\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Queen attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by queen.","code":"function $$(pos, square, s2) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  for (var i = 0; i < 8; i++) {\n    var ix = (i + (i > 3)) % 3 - 1;\n    var iy = (((i + (i > 3)) / 3) << 0) - 1;\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"Q\"\n      && (s2 == null || s2.x == square.x + d * ix && s2.y == square.y + d * iy)) {\n        var dir = $pinned_direction(pos, {x:square.x+d*ix, y:square.y+d*iy});\n        if (dir == 0 || Math.abs(ix+iy*3) == dir) v++;\n      }\n      if (b != \"-\") break;\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Outpost","group":"Pieces","text":"<b>$</b>. Outpost for knight or bishop.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"N\"\n   && board(pos, square.x, square.y) != \"B\") return 0;\n  if (!$outpost_square(pos, square)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Outpost square","group":"Pieces","text":"<b>$</b>. Outpost squares for knight or bishop.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($rank(pos, square) < 4 || $rank(pos, square) > 6) return 0;\n  if (board(pos, square.x - 1, square.y + 1) != \"P\"\n   && board(pos, square.x + 1, square.y + 1) != \"P\") return 0;\n  if ($pawn_attacks_span(pos, square)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Reachable outpost","group":"Pieces","text":"<b>$</b>. Knights and bishops which can reach an outpost square in one move.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\"\n   && board(pos, square.x, square.y) != \"N\") return 0;\n  var v = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 2; y < 5; y++) {\n      if ((board(pos, square.x, square.y) == \"N\"\n        && \"PNBRQK\".indexOf(board(pos, x, y)) < 0\n        && $knight_attack(pos, {x:x,y:y}, square)\n        && $outpost_square(pos, {x:x,y:y}))\n       || (board(pos, square.x, square.y) == \"B\"\n        && \"PNBRQK\".indexOf(board(pos, x, y)) < 0\n        && $bishop_xray_attack(pos, {x:x,y:y}, square)\n        && $outpost_square(pos, {x:x,y:y}))) {\n        var support = board(pos, x - 1, y + 1) == \"P\" || board(pos, x + 1, y + 1) == \"P\" ? 2 : 1;\n        v = Math.max(v, support);\n      }\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Minor behind pawn","group":"Pieces","text":"<b>$</b>. Knight or bishop when behind a pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\"\n   && board(pos, square.x, square.y) != \"N\") return 0;\n  if (board(pos, square.x, square.y - 1).toUpperCase() != \"P\") return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"-0.35","error":"4.5","link":"http://tests.stockfishchess.org/tests/view/5a723b850ebc590f2c86e9e5"}});
data.push({"name":"Bishop pawns","group":"Pieces","text":"<b>$</b>. Number of pawns on the same color square as the bishop multiplied by one plus the number of our blocked pawns in the center files C, D, E or F.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\") return 0;\n  var c = (square.x + square.y) % 2, v = 0;\n  var blocked = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"P\" && c == (x + y) % 2) v++;\n      if (board(pos, x, y) == \"P\"\n       && x > 1 && x < 6\n       && board(pos, x, y - 1) != \"-\") blocked++;\n    }\n  }\n  return v * (blocked + ($pawn_attack(pos, square) > 0 ? 0 : 1));\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"10.57","error":"4.6","link":"http://tests.stockfishchess.org/tests/view/5a7262390ebc590f2c86e9fc"}});
data.push({"name":"Rook on file","group":"Pieces","text":"<b>$</b>. Rook when on an open or semi-open file.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"R\") return 0;\n  var open = 1;\n  for (var y = 0; y < 8; y++) {\n    if (board(pos, square.x, y) == \"P\") return 0;\n    if (board(pos, square.x, y) == \"p\") open = 0;\n  }\n  return open + 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"13.59","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a78c23c0ebc5902971a991b"}});
data.push({"name":"Trapped rook","group":"Pieces","text":"<b>$</b>. Penalize rook when trapped by the king, even more if the king cannot castle.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"R\") return 0;\n  if ($rook_on_file(pos, square)) return 0;\n  if ($mobility(pos, square)> 3) return 0;\n  var kx = 0, ky = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"K\") { kx = x; ky = y; }\n    }\n  }\n  if ((kx < 4) != (square.x < kx)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"2.92","error":"3.7","link":"http://tests.stockfishchess.org/tests/view/5a876e560ebc590297cc82d9"}});
data.push({"name":"Weak queen","group":"Pieces","text":"<b>$</b>. Penalty if any relative pin or discovered attack against the queen.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"Q\") return 0;\n  for (var i = 0; i < 8; i++) {\n    var ix = (i + (i > 3)) % 3 - 1;\n    var iy = (((i + (i > 3)) / 3) << 0) - 1;\n    var count = 0;\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"r\" && (ix == 0 || iy == 0) && count == 1) return 1;\n      if (b == \"b\" && (ix != 0 && iy != 0) && count == 1) return 1;\n      if (b != \"-\") count++;\n    }\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"6.36","error":"4.6","link":"http://tests.stockfishchess.org/tests/view/5a73900b0ebc5902971a96a8"}});
data.push({"name":"Space area","group":"Space","text":"<b>$</b>. Number of safe squares available for minor pieces on the central four files on ranks 2 to 4. Safe squares one, two or three squares behind a friendly pawn are counted twice.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  var rank = $rank(pos, square);\n  var file = $file(pos, square);\n  if ((rank >= 2 && rank <= 4 && file >= 3 && file <= 6)\n   && (board(pos, square.x ,square.y) != \"P\")\n   && (board(pos, square.x - 1 ,square.y - 1) != \"p\")\n   && (board(pos, square.x + 1 ,square.y - 1) != \"p\")) {\n    v++;\n    if ((board(pos, square.x, square.y - 1) == \"P\"\n      || board(pos, square.x, square.y - 2) == \"P\"\n      || board(pos, square.x, square.y - 3) == \"P\")\n      && !$attack(colorflip(pos), {x:square.x, y:7-square.y})) v++;\n  }   \n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Pawn attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by pawn. Pins or en-passant attacks are not considered here.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  if (board(pos, square.x - 1, square.y + 1) == \"P\") v++;\n  if (board(pos, square.x + 1, square.y + 1) == \"P\") v++;\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"King attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  for (var i = 0; i < 8; i++) {\n    var ix = (i + (i > 3)) % 3 - 1;\n    var iy = (((i + (i > 3)) / 3) << 0) - 1;\n    if (board(pos, square.x + ix, square.y + iy) == \"K\") return 1;\n  }\n  \n \n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Attack","group":"Attack","text":"<b>$</b> counts number of attacks on square by all pieces. For bishop and rook x-ray attacks are included. For pawns pins or en-passant are ignored.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  v += $pawn_attack(pos, square);\n  v += $king_attack(pos, square);\n  v += $knight_attack(pos, square);\n  v += $bishop_xray_attack(pos, square);\n  v += $rook_xray_attack(pos, square);\n  v += $queen_attack(pos, square);\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true});
data.push({"name":"Non pawn material","group":"Material","text":"<b>$</b>. Middlegame value of non-pawn material.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var i = \"NBRQ\".indexOf(board(pos, square.x, square.y));\n  if (i >= 0) return $piece_value_bonus(pos, square, true);\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":false});
data.push({"name":"Safe pawn","group":"Threats","text":"<b>$</b>. Check if our pawn is not attacked or is defended.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if ($attack(pos, square)) return 1;\n  if (!$attack(colorflip(pos), {x:square.x,y:7-square.y})) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Threat safe pawn","group":"Threats","text":"<b>$</b>. Non-pawn enemies attacked by a [[Safe pawn]].","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"nbrq\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  if (!$pawn_attack(pos, square)) return 0;\n  if ($safe_pawn(pos, {x:square.x - 1, y:square.y + 1})\n   || $safe_pawn(pos, {x:square.x + 1, y:square.y + 1})) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":14.95,"error":4.6,"link":"http://tests.stockfishchess.org/tests/view/5a74bb6f0ebc5902971a9701"}});
data.push({"name":"Weak enemies","group":"Threats","text":"<b>$</b>. Enemies not defended by a pawn and under our attack.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"pnbrqk\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  if (board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x + 1, square.y - 1) == \"p\") return 0;\n  if (!$attack(pos, square)) return 0;\n  if ($attack(pos, square) <= 1\n   && $attack(colorflip(pos),{x:square.x,y:7-square.y}) > 1) return 0\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Minor threat","group":"Threats","text":"<b>$</b>. Threat type for knight and bishop attacking pieces.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var type = \"pnbrqk\".indexOf(board(pos, square.x, square.y));\n  if (type < 0) return 0;\n  if (!$knight_attack(pos, square) && !$bishop_xray_attack(pos, square)) return 0;\n  if ((board(pos, square.x, square.y) == \"p\"\n       || !(board(pos, square.x - 1, square.y - 1) == \"p\"\n         || board(pos, square.x + 1, square.y - 1) == \"p\"\n         || ($attack(pos, square) <= 1 && $attack(colorflip(pos),{x:square.x,y:7-square.y}) > 1)))\n    && !$weak_enemies(pos, square)) return 0;\n  return type + 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true});
data.push({"name":"Rook threat","group":"Threats","text":"<b>$</b>. Threat type for attacked by rook pieces.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var type = \"pnbrqk\".indexOf(board(pos, square.x, square.y));\n  if (type < 0) return 0;\n  if (!$weak_enemies(pos, square)) return 0;\n  if (!$rook_xray_attack(pos, square)) return 0;\n  return type + 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"10.98","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a7a14000ebc5902971a99e6"}});
data.push({"name":"Hanging","group":"Threats","text":"<b>$</b>. [[Weak enemies]] not defended by opponent or non-pawn [[weak enemies]] attacked twice.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$weak_enemies(pos, square)) return 0;\n  if (board(pos, square.x, square.y) != \"p\" && $attack(pos, square) > 1) return 1;\n  if (!$attack(colorflip(pos), {x:square.x,y:7-square.y})) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"2.78","error":"4.6","link":"http://tests.stockfishchess.org/tests/view/5a74c1ef0ebc5902971a9707"}});
data.push({"name":"King threat","group":"Threats","text":"<b>$</b>. Threat by king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"pnbrq\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  if (!$weak_enemies(pos, square)) return 0;\n  if (!$king_attack(pos, square)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"4.69","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a7a4dea0ebc5902971a99ff"}});
data.push({"name":"Pawn push threat","group":"Threats","text":"<b>$</b>. Bonus if some pawns can safely push and attack an enemy piece.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"pnbrqk\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  for (var ix = -1; ix <= 1; ix += 2) {\n    if (board(pos, square.x + ix, square.y + 2) == \"P\"\n     && board(pos, square.x + ix, square.y + 1) == \"-\"\n     && board(pos, square.x + ix - 1, square.y) != \"p\"\n     && board(pos, square.x + ix + 1, square.y) != \"p\"\n     && ($attack(pos, {x:square.x+ix,y:square.y+1})\n         || !$attack(colorflip(pos),{x:square.x+ix,y:6-square.y}))\n     ) return 1;\n\n    if (square.y == 3\n     && board(pos, square.x + ix, square.y + 3) == \"P\"\n     && board(pos, square.x + ix, square.y + 2) == \"-\"\n     && board(pos, square.x + ix, square.y + 1) == \"-\"\n     && board(pos, square.x + ix - 1, square.y) != \"p\"\n     && board(pos, square.x + ix + 1, square.y) != \"p\"\n     && ($attack(pos, {x:square.x+ix,y:square.y+1})\n         || !$attack(colorflip(pos),{x:square.x+ix,y:6-square.y}))\n     ) return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"7.89","error":"4.5","link":"http://tests.stockfishchess.org/tests/view/5a74f1300ebc5902971a9717"}});
data.push({"name":"Candidate passed","group":"Passed pawns","text":"<b>$</b> checks if pawn is passed or candidate passer. \nA pawn is passed if one of the three following conditions is true:\n<ul>\n<li>(a) there is no stoppers except some levers</li>\n<li>(b) the only stoppers are the leverPush, but we outnumber them</li>\n<li>(c) there is only one front stopper which can be levered.</li>\n</ul>\nIf there is a pawn of our color in the same file in front of a current pawn it's no longer counts as passed.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  var ty1 = 8, ty2 = 8, oy = 8;\n  for (var y = square.y - 1; y >= 0; y--) {\n    if (board(pos, square.x    , y) == \"P\") return 0;\n    if (board(pos, square.x    , y) == \"p\") ty1 = y;\n    if (board(pos, square.x - 1, y) == \"p\"\n     || board(pos, square.x + 1, y) == \"p\") ty2 = y;\n  }\n  if (ty1 == 8 && ty2 >= square.y - 1) return 1;\n  if (ty2 < square.y - 2 || ty1 < square.y - 1) return 0;\n  if (ty2 >= square.y && ty1 == square.y - 1 && square.y < 4) {\n    if (board(pos, square.x - 1, square.y + 1) == \"P\"\n     && board(pos, square.x - 1, square.y    ) != \"p\"\n     && board(pos, square.x - 2, square.y - 1) != \"p\") return 1;\n    if (board(pos, square.x + 1, square.y + 1) == \"P\"\n     && board(pos, square.x + 1, square.y    ) != \"p\"\n     && board(pos, square.x + 2, square.y - 1) != \"p\") return 1;\n  }\n  if (board(pos, square.x, square.y - 1) == \"p\") return 0;\n  var lever = (board(pos, square.x - 1, square.y - 1) == \"p\" ? 1 : 0)\n             + (board(pos, square.x + 1, square.y - 1) == \"p\" ? 1 : 0);\n  var leverpush = (board(pos, square.x - 1, square.y - 2) == \"p\" ? 1 : 0)\n                + (board(pos, square.x + 1, square.y - 2) == \"p\" ? 1 : 0);\n  var phalanx = (board(pos, square.x - 1, square.y) == \"P\" ? 1 : 0)\n              + (board(pos, square.x + 1, square.y) == \"P\" ? 1 : 0);\n  if (lever - $supported(pos, square) > 1) return 0;\n  if (leverpush - phalanx  > 0) return 0;\n  if (lever > 0 && leverpush > 0) return 0;\n  return 1;\n}","links":[["https://en.wikipedia.org/wiki/Passed_pawn","Passed pawn"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"King proximity","group":"Passed pawns","text":"<b>$</b> is endgame bonus based on the king's proximity. If block square is not the queening square then consider also a second push.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  var r = $rank(pos, square)-1;\n  var w = r > 2 ? 5 * r - 13 : 0;\n  var v = 0;\n  if (w <= 0) return 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\") {\n        v += ((Math.min(Math.max(Math.abs(y - square.y + 1),\n                        Math.abs(x - square.x)),5) * 19 / 4) << 0) * w;\n      }\n      if (board(pos, x, y) == \"K\") {\n        v -= Math.min(Math.max(Math.abs(y - square.y + 1),\n                      Math.abs(x - square.x)),5) * 2 * w;\n        if (square.y > 1) {\n          v -= Math.min(Math.max(Math.abs(y - square.y + 2),\n                      Math.abs(x - square.x)),5) * w;\n        }\n      }\n    }\n  }\n  return v;\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Passed block","group":"Passed pawns","text":"<b>$</b> adds bonus if passed pawn is free to advance. Bonus is adjusted based on attacked and defended status of block square and entire path in front of pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  if ($rank(pos, square) < 4) return 0;\n  if (board(pos, square.x, square.y - 1) != \"-\") return 0;\n  var r = $rank(pos, square) - 1;\n  var w = r > 2 ? 5 * r - 13 : 0;\n  var pos2 = colorflip(pos);\n  var defended = 0, unsafe = 0, wunsafe = 0, defended1 = 0, unsafe1 = 0;\n  for (var y = square.y - 1; y >= 0; y--) {\n    if ($attack(pos, {x:square.x,y:y})) defended++;\n    if ($attack(pos2, {x:square.x,y:7-y})) unsafe++;\n    if ($attack(pos2, {x:square.x-1,y:7-y})) wunsafe++;\n    if ($attack(pos2, {x:square.x+1,y:7-y})) wunsafe++;\n    if (y == square.y - 1) {\n      defended1 = defended;\n      unsafe1 = unsafe;\n    }\n  }\n  for (var y = square.y + 1; y < 8; y++) {\n    if (board(pos, square.x, y) == \"R\"\n     || board(pos, square.x, y) == \"Q\") defended1 = defended = square.y;\n    if (board(pos, square.x, y) == \"r\"\n     || board(pos, square.x, y) == \"q\") unsafe1 = unsafe = square.y;\n  }\n  var k = (unsafe == 0 && wunsafe == 0 ? 35 : unsafe == 0 ? 20 : unsafe1 == 0 ? 9 : 0)\n        + (defended1 != 0 ? 5 : 0);\n  return k * w;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Passed file","group":"Passed pawns","text":"<b>$</b> is a bonus according to the file of a passed pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  var file = $file(pos, square);\n  return Math.min(file - 1, 8 - file);\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"4.08","error":"4.1","link":"http://tests.stockfishchess.org/tests/view/5a84ed040ebc590297cc8144"}});
data.push({"name":"Passed rank","group":"Passed pawns","text":"<b>$</b> is a bonus according to the rank of a passed pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  return $rank(pos, square) - 1;\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"73.24","error":"4.9","link":"http://tests.stockfishchess.org/tests/view/5a84edbb0ebc590297cc8146"}});
data.push({"name":"Pawnless flank","group":"King","text":"<b>$</b>. Penalty when our king is on a pawnless flank.","code":"function $$(pos) {\n  var pawns=[0,0,0,0,0,0,0,0], kx = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y).toUpperCase() == \"P\") pawns[x]++;\n      if (board(pos, x, y) == \"k\") kx = x;\n    }\n  }\n  var sum;\n  if (kx == 0) sum = pawns[0] + pawns[1] + pawns[2];\n  else if (kx < 3) sum = pawns[0] + pawns[1] + pawns[2] + pawns[3];\n  else if (kx < 5) sum = pawns[2] + pawns[3] + pawns[4] + pawns[5];\n  else if (kx < 7) sum = pawns[4] + pawns[5] + pawns[6] + pawns[7];\n  else  sum = pawns[5] + pawns[6] + pawns[7];\n  return sum == 0 ? 1 : 0;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":true,"elo":{"value":"1.29","error":"4.5","link":"http://tests.stockfishchess.org/tests/view/5a73a7000ebc5902971a96b6"}});
data.push({"name":"Strength square","group":"King","text":"<b>$</b>. King shelter strength for each square on board.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 5;\n  var kx = Math.min(6, Math.max(1, square.x));\n  var weakness =\n      [[-6,81,93,58,39,18,25],\n      [-43,61,35,-49,-29,-11,-63],\n      [-10,75,23,-2,32,3,-45],\n      [-39,-13,-29,-52,-48,-67,-166]];\n  for (var x = kx - 1; x <= kx +1; x++) {\n    var us = 0;\n    for (var y = 7; y >= square.y; y--) {\n      if (board(pos, x, y) == \"p\"\n       && board(pos, x-1, y+1) != \"P\"\n       && board(pos, x+1, y+1) != \"P\") us = y;\n    }\n    var f = Math.min(x, 7 - x);\n    v += weakness[f][us] || 0;\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Storm square","group":"King","text":"<b>$</b>. Enemy pawns storm for each square on board.","code":"function $$(pos, square, eg) {\n  if (square == null) return sum(pos, $$);\n  var v = 0, ev = 5;\n  var kx = Math.min(6, Math.max(1, square.x));\n  var unblockedstorm = [\n    [85,-289,-166,97,50,45,50],\n    [46,-25,122,45,37,-10,20],\n    [-6,51,168,34,-2,-22,-14],\n    [-15,-11,101,4,11,-15,-29]];\n  var blockedstorm = [\n    [0,0,76,-10,-7,-4,-1],\n    [0,0,78,15,10,6,2]];\n  for (var x = kx - 1; x <= kx +1; x++) {\n    var us = 0, them = 0;\n    for (var y = 7; y >= square.y; y--) {\n      if (board(pos, x, y) == \"p\"\n       && board(pos, x-1, y+1) != \"P\"\n       && board(pos, x+1, y+1) != \"P\") us = y;\n      if (board(pos, x, y) == \"P\") them = y;\n    }\n    var f = Math.min(x, 7 - x);\n    if (us > 0 && them == us + 1) {\n      v += blockedstorm[0][them];\n      ev += blockedstorm[1][them];\n    }\n    else v += unblockedstorm[f][them];\n  }\n  return eg ? ev : v;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Shelter strength","group":"King","text":"<b>$</b>. King shelter bonus for king position. If we can castle use the penalty after the castling if ([[Shelter strength]] + [[Shelter storm]]) is smaller.","code":"function $$(pos, square) {\n  var w = 0, s = 1024, tx = null;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\"\n       || pos.c[2] && x == 6 && y == 0\n       || pos.c[3] && x == 2 && y == 0) {\n        var w1 = $strength_square(pos, {x:x,y:y});\n        var s1 = $storm_square(pos, {x:x,y:y});\n        if (s1 - w1 < s - w) { w = w1; s = s1; tx=Math.max(1,Math.min(6,x)); }\n      }\n    }\n  }\n  if (square == null) return w;\n  if (tx != null && board(pos, square.x, square.y) == \"p\" && square.x >= tx-1 && square.x <= tx+1) {\n    for (var y = square.y-1; y >= 0; y--) if (board(pos, square.x, y) == \"p\") return 0;\n    return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Shelter storm","group":"King","text":"<b>$</b>. Shelter strom penalty for king position. If we can castle use the penalty after the castling if ([[Shelter weakness]] + [[Shelter storm]]) is smaller.","code":"function $$(pos, square) {\n  var w = 0, s = 1024, tx = null;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\"\n       || pos.c[2] && x == 6 && y == 0\n       || pos.c[3] && x == 2 && y == 0) {\n        var w1 = $strength_square(pos, {x:x,y:y});\n        var s1 = $storm_square(pos, {x:x,y:y});\n        if (s1 - w1 < s - w) { w = w1; s = s1; tx=Math.max(1,Math.min(6,x)); }\n      }\n    }\n  }\n  if (square == null) return s;\n  if (tx != null && board(pos, square.x, square.y).toUpperCase() == \"P\" && square.x >= tx-1 && square.x <= tx+1) {\n    for (var y = square.y-1; y >= 0; y--) if (board(pos, square.x, y) == board(pos, square.x, square.y)) return 0;\n    return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"King pawn distance","group":"King","text":"<b>$</b>. Minimal distance of our king to our pawns.","code":"function $$(pos, square) {\n  var v = 6, kx = 0, ky = 0, px = 0, py = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"K\") {\n        kx = x;\n        ky = y;\n      }\n    }\n  }\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      var dist = Math.max(Math.abs(x-kx),Math.abs(y-ky));\n      if (board(pos, x, y) == \"P\" && dist < v) { px = x; py = y; v = dist; }\n    }\n  }\n  if (square == null || square.x == px && square.y == py) return v;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"3.71","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a7dacfd0ebc5902971a9bc3"}});
data.push({"name":"Check","group":"King","text":"<b>$</b>. Possible checks by knight, bishop, rook or queen. Defending queen is not considered as check blocker.","code":"function $$(pos, square, type) {\n  if (square == null) return sum(pos, $$);\n  if ($rook_xray_attack(pos, square)\n  && (type == null || type == 2 || type == 4)\n   || $queen_attack(pos, square)\n  && (type == null || type == 3)) {\n    for (var i = 0; i < 4; i++) {\n      var ix = (i == 0 ? -1 : i == 1 ? 1 : 0);\n      var iy = (i == 2 ? -1 : i == 3 ? 1 : 0);\n      for (var d = 1; d < 8; d++) {\n        var b = board(pos, square.x + d * ix, square.y + d * iy);\n        if (b == \"k\") return 1;\n        if (b != \"-\" && b != \"q\") break;\n      }\n    }\n  }\n  if ($bishop_xray_attack(pos, square)\n  && (type == null || type == 1 || type == 4)\n   || $queen_attack(pos, square)\n  && (type == null || type == 3)) {\n    for (var i = 0; i < 4; i++) {\n      var ix = ((i > 1) * 2 - 1);\n      var iy = ((i % 2 == 0) * 2 - 1);\n      for (var d = 1; d < 8; d++) {\n        var b = board(pos, square.x + d * ix, square.y + d * iy);\n        if (b == \"k\") return 1;\n        if (b != \"-\" && b != \"q\") break;\n      }\n    }\n  }\n  if ($knight_attack(pos, square)\n  && (type == null || type == 0 || type == 4)) {\n    if (board(pos, square.x + 2, square.y + 1) == \"k\"\n     || board(pos, square.x + 2, square.y - 1) == \"k\"\n     || board(pos, square.x + 1, square.y + 2) == \"k\"\n     || board(pos, square.x + 1, square.y - 2) == \"k\"\n     || board(pos, square.x - 2, square.y + 1) == \"k\"\n     || board(pos, square.x - 2, square.y - 1) == \"k\"\n     || board(pos, square.x - 1, square.y + 2) == \"k\"\n     || board(pos, square.x - 1, square.y - 2) == \"k\") return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Safe check","group":"King","text":"<b>$</b>. Analyse the safe enemy's checks which are possible on next move. Enemy queen safe checks: we count them only if they are from squares from which we can't give a rook check, because rook checks are more valuable. Enemy bishops checks: we count them only if they are from squares from which we can't give a queen check, because queen checks are more valuable.","code":"function $$(pos, square, type) {\n  if (square == null) return sum(pos, $$, type);\n  if (\"PNBRQK\".indexOf(board(pos, square.x, square.y)) >= 0) return 0;\n  if (!$check(pos, square, type)) return 0;\n  var pos2 = colorflip(pos);\n  if (type == 3 && $safe_check(pos, square, 2)) return 0;\n  if (type == 1 && $safe_check(pos, square, 3)) return 0;\n  if ((!$attack(pos2, {x:square.x,y:7-square.y})\n    || ($weak_squares(pos, square) && $attack(pos, square) > 1))\n    && (type != 3 || !$queen_attack(pos2, {x:square.x,y:7-square.y}))) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Queen count","group":"Helpers","text":"<b>$</b> counts number of our queens.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"Q\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"King attackers count","group":"King","text":"<b>$</b> is the number of pieces of the given color which attack a square in the kingRing of the enemy king. For pawns we count number of attacked squares in kingRing.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"PNBRQ\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  if (board(pos, square.x, square.y) == \"P\") {\n    var v = 0;\n    for (var dir = -1; dir <= 1; dir += 2) {\n      var fr = board(pos, square.x + dir * 2, square.y) == \"P\";\n      if (square.x + dir >= 0 && square.x + dir <= 7\n       && $king_ring(pos, {x:square.x+dir,y:square.y-1}, true)) v = v + (fr ? 0.5 : 1);\n    }\n    return v;\n  }\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      var s2 = {x:x,y:y};\n      if ($king_ring(pos, s2)) {\n        if ($knight_attack(pos, s2, square)\n         || $bishop_xray_attack(pos, s2, square)\n         || $rook_xray_attack(pos, s2, square)\n         || $queen_attack(pos, s2, square)) return 1;\n      }\n    }\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"King attackers weight","group":"King","text":"<b>$</b> is the sum of the \"weights\" of the pieces of the given color which attack a square in the kingRing of the enemy king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($king_attackers_count(pos, square)) {\n    return [0,81,52,44,10][\"PNBRQ\".indexOf(board(pos, square.x, square.y))];\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"King attacks","group":"King","text":"<b>$</b> is the number of attacks by the given color to squares directly adjacent to the enemy king. Pieces which attack more than one square are counted multiple times. For instance, if there is a white knight on g5 and black's king is on g8, this white knight adds 2.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"NBRQ\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  if ($king_attackers_count(pos, square) == 0) return 0;\n  var kx = 0, ky = 0, v = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\") { kx = x; ky = y; }\n    }\n  }\n  for (var x = kx - 1; x <= kx + 1; x++) {\n    for (var y = ky - 1; y <= ky + 1; y++) {\n      var s2 = {x:x,y:y};\n      if (x >= 0 && y >= 0 && x <= 7 && y <= 7 && (x != kx || y != ky)) {\n        v += $knight_attack(pos, s2, square);\n        v += $bishop_xray_attack(pos, s2, square);\n        v += $rook_xray_attack(pos, s2, square);\n        v += $queen_attack(pos, s2, square);\n      }\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Weak bonus","group":"King","text":"<b>$</b>. Weak squares in king ring.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$weak_squares(pos, square)) return 0;\n  if (!$king_ring(pos, square)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Weak squares","group":"King","text":"<b>$</b>. Attacked squares defended at most once by our queen or king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($attack(pos, square)) {\n    var pos2 = colorflip(pos);\n    var attack = $attack(pos2, {x:square.x,y:7-square.y});\n    if (attack >= 2) return 0;\n    if (attack == 0) return 1;\n    if ($king_attack(pos2, {x:square.x,y:7-square.y})\n     || $queen_attack(pos2, {x:square.x,y:7-square.y})) return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Winnable","group":"Winnable","text":"<b>$</b> computes the winnable correction value for the position, i.e., second order bonus/malus based on the known attacking/defending status of the players.","code":"function $$(pos, square) {\n  if (square != null) return 0;\n  var pawns = 0, kx = [0, 0], ky = [0, 0], flanks = [0, 0];\n  for (var x = 0; x < 8; x++) {\n    var open = [0, 0];\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y).toUpperCase() == \"P\" ) {\n        open[board(pos, x, y) == \"P\" ? 0 : 1] = 1;\n        pawns++\n      }\n      if (board(pos, x, y).toUpperCase() == \"K\" ) {\n        kx[board(pos, x, y) == \"K\" ? 0 : 1] = x;\n        ky[board(pos, x, y) == \"K\" ? 0 : 1] = y;\n      }\n    }\n    if (open[0] + open[1] > 0) flanks[x < 4 ? 0 : 1] = 1;\n  }\n  var pos2 = colorflip(pos);\n  var passedCount = $candidate_passed(pos) + $candidate_passed(pos2);\n  var bothFlanks = flanks[0] && flanks[1] ? 1 : 0;\n  var outflanking = Math.abs(kx[0] - kx[1]) - Math.abs(ky[0] - ky[1]);\n  var purePawn = ($non_pawn_material(pos) + $non_pawn_material(pos2)) == 0 ? 1 : 0;\n  var almostUnwinnable = outflanking < 0 && bothFlanks == 0;\n  var infiltration = ky[0] < 4 || ky[1] > 3 ? 1 : 0;\n  return 9 * passedCount\n       + 12 * pawns\n       + 9 * outflanking\n       + 21 * bothFlanks\n       + 24 * infiltration\n       + 51 * purePawn\n       - 43 * almostUnwinnable\n       - 110;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":true,"elo":null});
data.push({"name":"Unsafe checks","group":"King","text":"<b>$</b>. Unsafe checks.\n","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($check(pos, square, 0) && $safe_check(pos, null, 0) == 0) return 1;\n  if ($check(pos, square, 1) && $safe_check(pos, null, 1) == 0) return 1;\n  if ($check(pos, square, 2) && $safe_check(pos, null, 2) == 0) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Tempo","group":"","text":"<b>$</b>. In chess, tempo refers to a \"turn\" or single move. When a player achieves a desired result in one fewer move, the player \"gains a tempo\"; and conversely when a player takes one more move than necessary, the player \"loses a tempo\". We add small bonus for having the right to move.","code":"function $$(pos, square) {\n  if (square != null) return 0;\n  return 28 * (pos.w ? 1 : -1);\n}","links":[["https://en.wikipedia.org/wiki/Tempo_(chess)","Tempo (chess) in wikipedia"],["https://www.chessprogramming.org/Tempo","Tempo in cpw"]],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"Pawn count","group":"Helpers","text":"<b>$</b> counts number of our pawns.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"P\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Connected bonus","group":"Pawns","text":"<b>$</b> is bonus for connected pawns.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$connected(pos, square)) return 0;\n  var seed = [0, 7, 8, 12, 29, 48, 86];\n  var op = $opposed(pos, square);\n  var ph = $phalanx(pos, square);\n  var su = $supported(pos, square);\n  var bl = board(pos, square.x, square.y - 1) == \"p\" ? 1 : 0;\n  var r = $rank(pos, square);\n  if (r < 2 || r > 7) return 0;\n  return seed[r - 1] * (2 + ph - op) + 21 * su;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Mobility mg","group":"Mobility","text":"<b>$</b>. [[Mobility bonus]] for middlegame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $mobility_bonus(pos, square, true);\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Mobility eg","group":"Mobility","text":"<b>$</b>. [[Mobility bonus]] for endgame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $mobility_bonus(pos, square, false);\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true});
data.push({"name":"Piece value bonus","group":"Material","text":"<b>$</b>. Material values for middlegame and engame.","code":"function $$(pos, square, mg) {\n  if (square == null) return sum(pos, $$);\n  var a = mg ? [124, 781, 825, 1276, 2538]\n             : [206, 854, 915, 1380, 2682];\n  var i = \"PNBRQ\".indexOf(board(pos, square.x, square.y));\n  if (i >= 0) return a[i];\n  return 0;\n}","links":[],"eval":false,"squares":0,"highlight":0,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Psqt bonus","group":"Material","text":"<b>$</b>. Piece square table bonuses. For each piece type on a given square a (middlegame, endgame) score pair is assigned.","code":"function $$(pos, square, mg) {\n  if (square == null) return sum(pos, $$, mg);\n  var bonus = mg ? [\n    [[-175,-92,-74,-73],[-77,-41,-27,-15],[-61,-17,6,12],[-35,8,40,49],[-34,13,44,51],[-9,22,58,53],[-67,-27,4,37],[-201,-83,-56,-26]],\n    [[-53,-5,-8,-23],[-15,8,19,4],[-7,21,-5,17],[-5,11,25,39],[-12,29,22,31],[-16,6,1,11],[-17,-14,5,0],[-48,1,-14,-23]],\n    [[-31,-20,-14,-5],[-21,-13,-8,6],[-25,-11,-1,3],[-13,-5,-4,-6],[-27,-15,-4,3],[-22,-2,6,12],[-2,12,16,18],[-17,-19,-1,9]],\n    [[3,-5,-5,4],[-3,5,8,12],[-3,6,13,7],[4,5,9,8],[0,14,12,5],[-4,10,6,8],[-5,6,10,8],[-2,-2,1,-2]],\n    [[271,327,271,198],[278,303,234,179],[195,258,169,120],[164,190,138,98],[154,179,105,70],[123,145,81,31],[88,120,65,33],[59,89,45,-1]]\n  ] : [\n    [[-96,-65,-49,-21],[-67,-54,-18,8],[-40,-27,-8,29],[-35,-2,13,28],[-45,-16,9,39],[-51,-44,-16,17],[-69,-50,-51,12],[-100,-88,-56,-17]],\n    [[-57,-30,-37,-12],[-37,-13,-17,1],[-16,-1,-2,10],[-20,-6,0,17],[-17,-1,-14,15],[-30,6,4,6],[-31,-20,-1,1],[-46,-42,-37,-24]],\n    [[-9,-13,-10,-9],[-12,-9,-1,-2],[6,-8,-2,-6],[-6,1,-9,7],[-5,8,7,-6],[6,1,-7,10],[4,5,20,-5],[18,0,19,13]],\n    [[-69,-57,-47,-26],[-55,-31,-22,-4],[-39,-18,-9,3],[-23,-3,13,24],[-29,-6,9,21],[-38,-18,-12,1],[-50,-27,-24,-8],[-75,-52,-43,-36]],\n    [[1,45,85,76],[53,100,133,135],[88,130,169,175],[103,156,172,172],[96,166,199,199],[92,172,184,191],[47,121,116,131],[11,59,73,78]]\n  ];\n  var pbonus = mg ? \n    [[0,0,0,0,0,0,0,0],[3,3,10,19,16,19,7,-5],[-9,-15,11,15,32,22,5,-22],[-4,-23,6,20,40,17,4,-8],[13,0,-13,1,11,-2,-13,5],\n     [5,-12,-7,22,-8,-5,-15,-8],[-7,7,-3,-13,5,-16,10,-8],[0,0,0,0,0,0,0,0]]:\n    [[0,0,0,0,0,0,0,0],[-10,-6,10,0,14,7,-5,-19],[-10,-10,-10,4,4,3,-6,-4],[6,-2,-8,-4,-13,-12,-10,-9],[10,5,4,-5,-5,-5,14,9],\n     [28,20,21,28,30,7,6,13],[0,-11,12,21,25,19,4,7],[0,0,0,0,0,0,0,0]];\n  var i = \"PNBRQK\".indexOf(board(pos, square.x, square.y));\n  if (i < 0) return 0;\n  if (i == 0) return pbonus[7 - square.y][square.x];\n  else return bonus[i-1][7 - square.y][Math.min(square.x, 7 - square.x)];\n}","links":[],"eval":false,"squares":0,"highlight":0,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Piece value mg","group":"Material","text":"<b>$</b>. Material - middlegame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $piece_value_bonus(pos, square, true);\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true});
data.push({"name":"Piece value eg","group":"Material","text":"<b>$</b>. Material - endgame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $piece_value_bonus(pos, square, false);\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true});
data.push({"name":"Psqt mg","group":"Material","text":"<b>$</b>. Piece square table bonuses - middlegame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $psqt_bonus(pos, square, true);\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true});
data.push({"name":"Psqt eg","group":"Material","text":"<b>$</b>. Piece square table bonuses - endgame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  return $psqt_bonus(pos, square, false);\n}\n\n","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true});
data.push({"name":"King protector","group":"Pieces","text":"<b>$</b> add penalties and bonuses for pieces, depending on the distance from the own king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"N\"\n   && board(pos, square.x, square.y) != \"B\") return 0;\n  return $king_distance(pos, square);\n}","links":[],"eval":false,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"5.82","error":"4.1","link":"http://tests.stockfishchess.org/tests/view/5a7af24e0ebc5902971a9a3c"}});
data.push({"name":"Knight count","group":"Helpers","text":"<b>$</b> counts number of our knights.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"N\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Imbalance total","group":"Imbalance","text":"<b>$</b>. Second-degree polynomial material imbalance by Tord Romstad.","code":"function $$(pos, square) {\n  var v = 0;\n  v += $imbalance(pos) - $imbalance(colorflip(pos));\n  v += $bishop_pair(pos) - $bishop_pair(colorflip(pos));\n  return (v / 16) << 0;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false});
data.push({"name":"Weak unopposed pawn","group":"Pawns","text":"<b>$</b>. Check if our pawn is weak and unopposed.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($opposed(pos, square)) return 0;\n  var v = 0;\n  if ($isolated(pos, square)) v++;\n  else if ($backward(pos, square)) v++;\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"1.25","error":"4.5","link":"http://tests.stockfishchess.org/tests/view/5a74e8d40ebc5902971a9715"}});
data.push({"name":"Rook count","group":"Helpers","text":"<b>$</b> counts number of our rooks.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) == \"R\") return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Opposite bishops","group":"Helpers","text":"<b>$</b> determines if we have bishops of opposite colors.","code":"function $$(pos) {\n  if ($bishop_count(pos) != 1) return 0;\n  if ($bishop_count(colorflip(pos)) != 1) return 0;\n  var color = [0, 0];\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"B\") color[0] = (x + y) % 2;\n      if (board(pos, x, y) == \"b\") color[1] = (x + y) % 2;\n    }\n  }\n  return color[0] == color[1] ? 0 : 1;\n}","links":[["https://www.chessprogramming.org/Bishops_of_Opposite_Colors","Bishops of Opposite Colors in cpw"]],"eval":true,"squares":0,"highlight":0,"forwhite":false,"graph":false});
data.push({"name":"King distance","group":"Helpers","text":"<b>$</b> counts distance to our king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"K\") {\n        return Math.max(Math.abs(x - square.x), Math.abs(y - square.y));\n      }\n    }\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Long diagonal bishop","group":"Pieces","text":"<b>$</b>. Bonus for bishop on a long diagonal which can \"see\" both center squares.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\") return 0;\n  if (square.x - square.y != 0 && square.x - (7 - square.y) != 0) return 0;\n  var x1 = square.x, y1 = square.y;\n  if (Math.min(x1,7-x1) > 2) return 0;\n  for (var i = Math.min(x1,7-x1); i < 4; i++) {\n    if (board(pos, x1, y1) == \"p\") return 0;\n    if (board(pos, x1, y1) == \"P\") return 0;\n    if (x1 < 4) x1++; else x1--;\n    if (y1 < 4) y1++; else y1--;\n  }\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":{"value":"-1.15","error":"2.9","link":"http://tests.stockfishchess.org/tests/view/5a75acec0ebc5902971a975f"}});
data.push({"name":"Queen attack diagonal","group":"Attack","text":"<b>$</b> counts number of attacks on square by queen only with diagonal direction.","code":"function $$(pos, square, s2) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  for (var i = 0; i < 8; i++) {\n    var ix = (i + (i > 3)) % 3 - 1;\n    var iy = (((i + (i > 3)) / 3) << 0) - 1;\n    if (ix == 0 || iy == 0) continue;\n    for (var d = 1; d < 8; d++) {\n      var b = board(pos, square.x + d * ix, square.y + d * iy);\n      if (b == \"Q\"\n      && (s2 == null || s2.x == square.x + d * ix && s2.y == square.y + d * iy)) {\n        var dir = $pinned_direction(pos, {x:square.x+d*ix, y:square.y+d*iy});\n        if (dir == 0 || Math.abs(ix+iy*3) == dir) v++;\n      }\n      if (b != \"-\") break;\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"Pinned","group":"Attack","text":"<b>$</b>. In chess, absolute pin is a situation brought on by a sliding attacking piece in which a defending piece cannot move because moving away the pinned piece would illegally expose the king to check.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"PNBRQK\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  return $pinned_direction(pos, square) > 0 ? 1 : 0;\n}","links":[["https://en.wikipedia.org/wiki/Pin_(chess)","Pin in wikipedia"],["https://www.chessprogramming.org/Pin","Pin in cpw"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false});
data.push({"name":"King ring","group":"Helpers","text":"<b>$</b> is square occupied by king and 8 squares around king. Squares defended by two pawns are removed from king ring.","code":"function $$(pos, square, full) {\n  if (square == null) return sum(pos, $$);\n  if (!full\n   && board(pos, square.x + 1, square.y - 1) == \"p\"\n   && board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  for (var ix = -2; ix <= 2; ix++) {\n    for (var iy = -2; iy <= 2; iy++) {\n      if (board(pos, square.x + ix, square.y + iy) == \"k\"\n      && (ix >= -1 && ix <= 1 || square.x + ix == 0 || square.x + ix == 7)\n      && (iy >= -1 && iy <= 1 || square.y + iy == 0 || square.y + iy == 7)) return 1;\n    }\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Slider on queen","group":"Threats","text":"<b>$</b>. Add a bonus for safe slider attack threats on opponent queen.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var pos2 = colorflip(pos);\n  if ($queen_count(pos2) != 1) return 0;\n  if (board(pos, square.x, square.y) == \"P\") return 0;\n  if (board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x + 1, square.y - 1) == \"p\") return 0;\n  if ($attack(pos, square) <= 1) return 0;\n  if (!$mobility_area(pos, square)) return 0;\n  var diagonal = $queen_attack_diagonal(pos2, {x:square.x, y:7-square.y});\n  var v = $queen_count(pos) == 0 ? 2 : 1;\n  if (diagonal && $bishop_xray_attack(pos, square)) return v;\n  if (!diagonal\n   && $rook_xray_attack(pos, square)\n   && $queen_attack(pos2, {x:square.x, y:7-square.y})) return v;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Knight on queen","group":"Threats","text":"<b>$</b>. Add a bonus for safe knight attack threats on opponent queen.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var pos2 = colorflip(pos);\n  var qx = -1, qy = -1;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"q\") {\n        if (qx >= 0 || qy >= 0) return 0;\n        qx = x;\n        qy = y;\n      }\n    }\n  }\n  if ($queen_count(pos2) != 1) return 0;\n  if (board(pos, square.x, square.y) == \"P\") return 0;\n  if (board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x + 1, square.y - 1) == \"p\") return 0;\n  if ($attack(pos, square) <= 1 && $attack(pos2, {x:square.x, y:7-square.y}) > 1) return 0;\n  if (!$mobility_area(pos, square)) return 0;\n  if (!$knight_attack(pos, square)) return 0;\n  var v = $queen_count(pos) == 0 ? 2 : 1;\n  if (Math.abs(qx-square.x) == 2 && Math.abs(qy-square.y) == 1) return v;\n  if (Math.abs(qx-square.x) == 1 && Math.abs(qy-square.y) == 2) return v;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Outpost total","group":"Pieces","text":"<b>$</b>. Middlegame and endgame bonuses for knights and bishops outposts, bigger if outpost piece is supported by a pawn.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"N\"\n   && board(pos, square.x, square.y) != \"B\") return 0;\n  var knight = board(pos, square.x, square.y) == \"N\";\n  var reachable = 0;\n  if (!$outpost(pos, square)) {\n    if (!knight) return 0;\n    reachable = $reachable_outpost(pos, square);\n    if (!reachable) return 0;\n    return 1;\n  }\n  if (knight && (square.x < 2 || square.x > 5)) {\n    var ea = 0, cnt = 0;\n    for (var x = 0; x < 8; x++) {\n      for (var y = 0; y < 8; y++) {\n        if ((Math.abs(square.x - x) == 2 && Math.abs(square.y - y) == 1\n          || Math.abs(square.x - x) == 1 && Math.abs(square.y - y) == 2)\n          && \"nbrqk\".indexOf(board(pos, x, y)) >= 0) ea = 1;\n        if ((x < 4 && square.x < 4 || x >= 4 && square.x >= 4)\n          && \"nbrqk\".indexOf(board(pos, x, y)) >= 0) cnt++;\n      }\n    }\n    if (!ea && cnt <= 1) return 2;\n  }\n  return knight ? 4 : 3;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":true,"elo":{"value":"12.05","error":"4.2","link":"http://tests.stockfishchess.org/tests/view/5a774a8b0ebc5902971a9877"}});
data.push({"name":"Restricted","group":"Threats","text":"<b>$</b>. Bonus for restricting their piece moves.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($attack(pos, square) == 0) return 0;\n  var pos2 = colorflip(pos);\n  if (!$attack(pos2, {x:square.x,y:7-square.y})) return 0;\n  if ($pawn_attack(pos2, {x:square.x,y:7-square.y}) > 0) return 0;\n  if ($attack(pos2, {x:square.x,y:7-square.y}) > 1 && $attack(pos, square) == 1) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Knight defender","group":"King","text":"<b>$</b>. Squares defended by knight near our king.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($knight_attack(pos, square) && $king_attack(pos, square)) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Endgame shelter","group":"King","text":"<b>$</b>. Add an endgame component to the blockedstorm penalty so that the penalty applies more uniformly through the game.","code":"function $$(pos, square) {\n  var w = 0, s = 1024, tx = null;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\"\n       || pos.c[2] && x == 6 && y == 0\n       || pos.c[3] && x == 2 && y == 0) {\n        var w1 = $strength_square(pos, {x:x,y:y});\n        var s1 = $storm_square(pos, {x:x,y:y});\n        var e1 = $storm_square(pos, {x:x,y:y}, true);\n        if (s1 - w1 < s - w) { w = w1; s = s1; e = e1; }\n      }\n    }\n  }\n  if (square == null) return e;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Space","group":"Space","text":"<b>$</b> computes the space evaluation for a given side. The [[Space area]] bonus is multiplied by a weight: number of our pieces minus two times number of open files. The aim is to improve play on game opening.","code":"function $$(pos, square) {\n  if ($non_pawn_material(pos) + $non_pawn_material(colorflip(pos)) < 12222) return 0;\n  var pieceCount = 0, blockedCount = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (\"PNBRQK\".indexOf(board(pos, x, y)) >= 0) pieceCount++;\n      if (board(pos, x, y) == \"P\" && (board(pos, x, y - 1) == \"p\" || (board(pos, x - 1, y - 2) == \"p\" && board(pos, x + 1, y - 2) == \"p\"))) blockedCount++;\n      if (board(pos, x, y) == \"p\" && (board(pos, x, y + 1) == \"P\" || (board(pos, x - 1, y + 2) == \"P\" && board(pos, x + 1, y + 2) == \"P\"))) blockedCount++;\n    }\n  }\n  var weight = pieceCount - 3 + Math.min(blockedCount, 9);\n  return (($space_area(pos, square) * weight * weight / 16) << 0);\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Weak lever","group":"Pawns","text":"<b>$</b>. Penalize our unsupported pawns attacked twice by enemy pawns","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if (board(pos, square.x - 1, square.y - 1) != \"p\") return 0;\n  if (board(pos, square.x + 1, square.y - 1) != \"p\") return 0;\n  if (board(pos, square.x - 1, square.y + 1) == \"P\") return 0;\n  if (board(pos, square.x + 1, square.y + 1) == \"P\") return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Blockers for king","group":"King","text":"<b>$</b>. Blockers for king\n","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if ($pinned_direction(colorflip(pos), {x:square.x,y:7-square.y})) return 1;\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Rook on queen file","group":"Pieces","text":"<b>$</b>. simple bonus for a rook that is on the same file as any queen.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"R\") return 0;\n  for (var y = 0; y < 8; y++) {\n    if (board(pos, square.x, y).toUpperCase() == \"Q\") return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Winnable total mg","group":"Winnable","text":"<b>$</b>. Middle game winnable.","code":"function $$(pos, v) {\n  if (v == null) v = $middle_game_evaluation(pos, true);\n  return (v > 0 ? 1 : v < 0 ? -1 : 0)\n         * Math.max(Math.min($winnable(pos)+50, 0), -Math.abs(v));\n}","links":[],"eval":false,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"Winnable total eg","group":"Winnable","text":"<b>$</b>. End game winnable.","code":"function $$(pos, v) {\n  if (v == null) v = $end_game_evaluation(pos, true);\n  return (v > 0 ? 1 : v < 0 ? -1 : 0)\n         * Math.max($winnable(pos), -Math.abs(v));\n}","links":[],"eval":false,"squares":0,"highlight":0,"forwhite":false,"graph":false,"elo":null});
data.push({"name":"Flank attack","group":"King","text":"<b>$</b>. Find the squares that opponent attacks in our king flank and the squares which they attack twice in that flank.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (square.y > 4) return 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\") {\n        if (x == 0 && square.x > 2) return 0;\n        if (x < 3 && square.x > 3) return 0;\n        if (x >= 3 && x < 5 && (square.x < 2 || square.x > 5)) return 0;\n        if (x >= 5 && square.x < 4) return 0;\n        if (x == 7 && square.x < 5) return 0;\n      }\n    }\n  }\n  var a = $attack(pos, square);\n  if (!a) return 0;\n  return a > 1 ? 2 : 1;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":true,"elo":{"value":"2.19","error":"4.6","link":"http://tests.stockfishchess.org/tests/view/5a7399f10ebc5902971a96b3"}});
data.push({"name":"Flank defense","group":"King","text":"<b>$</b>. Find the squares that we defend in our king flank.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (square.y > 4) return 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"k\") {\n        if (x == 0 && square.x > 2) return 0;\n        if (x < 3 && square.x > 3) return 0;\n        if (x >= 3 && x < 5 && (square.x < 2 || square.x > 5)) return 0;\n        if (x >= 5 && square.x < 4) return 0;\n        if (x == 7 && square.x < 5) return 0;\n      }\n    }\n  }\n  return $attack(colorflip(pos), {x:square.x,y:7-square.y}) > 0 ? 1 : 0;\n}","links":[],"eval":true,"squares":1,"highlight":0,"forwhite":true,"graph":true,"elo":{"value":"2.19","error":"4.6","link":"http://tests.stockfishchess.org/tests/view/5a7399f10ebc5902971a96b3"}});
data.push({"name":"King danger","group":"King","text":"<b>$</b>. The initial value is based on the number and types of the enemy's attacking pieces, the number of attacked and undefended squares around our king and the quality of the pawn shelter.","code":"function $$(pos) {\n  var count = $king_attackers_count(pos);\n  var weight = $king_attackers_weight(pos);\n  var kingAttacks = $king_attacks(pos);\n  var weak = $weak_bonus(pos);\n  var unsafeChecks = $unsafe_checks(pos);\n  var blockersForKing = $blockers_for_king(pos);\n  var kingFlankAttack = $flank_attack(pos);\n  var kingFlankDefense = $flank_defense(pos);\n  var noQueen = ($queen_count(pos) > 0 ? 0 : 1);\n  var v = count * weight\n        +  69 * kingAttacks\n        + 185 * weak\n        - 100 * ($knight_defender(colorflip(pos)) > 0)\n        + 148 * unsafeChecks\n        +  98 * blockersForKing\n        -   4 * kingFlankDefense\n        + ((3 * kingFlankAttack * kingFlankAttack / 8) << 0)\n        - 873 * noQueen\n        - ((6 * ($shelter_strength(pos) - $shelter_storm(pos)) / 8) << 0)\n        + $mobility_mg(pos) - $mobility_mg(colorflip(pos))\n        + 37\n        +  ((772 * Math.min($safe_check(pos, null, 3), 1.45)) << 0)\n        + ((1084 * Math.min($safe_check(pos, null, 2), 1.75)) << 0)\n        +  ((645 * Math.min($safe_check(pos, null, 1), 1.50)) << 0)\n        +  ((792 * Math.min($safe_check(pos, null, 0), 1.62)) << 0);\n  if (v > 100) return v;\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"King mg","group":"King","text":"<b>$</b> assigns middlegame bonuses and penalties for attacks on enemy king.","code":"function $$(pos) {\n  var v = 0;\n  var kd = $king_danger(pos);\n  v -= $shelter_strength(pos);\n  v += $shelter_storm(pos);\n  v += (kd * kd / 4096) << 0;\n  v += 8 * $flank_attack(pos);\n  v += 17 * $pawnless_flank(pos);\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"King eg","group":"King","text":"<b>$</b> assigns endgame bonuses and penalties for attacks on enemy king.","code":"function $$(pos) {\n  var v = 0;\n  v -= 16 * $king_pawn_distance(pos);\n  v += $endgame_shelter(pos);\n  v += 95 * $pawnless_flank(pos);\n  v += ($king_danger(pos) / 16) << 0;\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Weak queen protection","group":"Threats","text":"<b>$</b>. Additional bonus if weak piece is only protected by a queen","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$weak_enemies(pos, square)) return 0;\n  if (!$queen_attack(colorflip(pos), {x:square.x,y:7-square.y})) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Threats mg","group":"Threats","text":"<b>$</b>. Middlegame threats bonus.","code":"function $$(pos) {\n  var v = 0;\n  v += 69 * $hanging(pos);\n  v += $king_threat(pos) > 0 ? 24 : 0;\n  v += 48 * $pawn_push_threat(pos);\n  v += 173 * $threat_safe_pawn(pos);\n  v += 60 * $slider_on_queen(pos);\n  v += 16 * $knight_on_queen(pos);\n  v += 7 * $restricted(pos);\n  v += 14 * $weak_queen_protection(pos);\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      var s = {x:x,y:y};\n      v += [0,5,57,77,88,79,0][$minor_threat(pos, s)];\n      v += [0,3,37,42,0,58,0][$rook_threat(pos, s)];\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Threats eg","group":"Threats","text":"<b>$</b>. Endgame threats bonus.","code":"function $$(pos) {\n  var v = 0;\n  v += 36 * $hanging(pos);\n  v += $king_threat(pos) > 0 ? 89 : 0;\n  v += 39 * $pawn_push_threat(pos);\n  v += 94 * $threat_safe_pawn(pos);\n  v += 18 * $slider_on_queen(pos);\n  v += 11 * $knight_on_queen(pos);\n  v += 7 * $restricted(pos);\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      var s = {x:x,y:y};\n      v += [0,32,41,56,119,161,0][$minor_threat(pos, s)];\n      v += [0,46,68,60,38,41,0][$rook_threat(pos, s)];\n    }\n  }\n  return v;\n}","links":[],"eval":true,"squares":0,"highlight":0,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Passed leverable","group":"Passed pawns","text":"<b>$</b>. Candidate passers without candidate passers w/o feasible lever.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$candidate_passed(pos, square)) return 0;\n  if (board(pos, square.x, square.y - 1) != \"p\") return 1;\n  var pos2 = colorflip(pos);\n  for (var i = -1; i <=1; i+=2) {\n    var s1 = {x:square.x + i, y:square.y};\n    var s2 = {x:square.x + i, y:7-square.y};\n    if (board(pos, square.x + i, square.y + 1) == \"P\"\n     && \"pnbrqk\".indexOf(board(pos, square.x + i, square.y)) < 0\n     && ($attack(pos, s1) > 0 || $attack(pos2, s2) <= 1)\n    ) return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Passed mg","group":"Passed pawns","text":"<b>$</b> middlegame bonuses for passed pawns. Scale down bonus for candidate passers which need more than one pawn push to become passed, or have a pawn in front of them.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  var v = 0;\n  v += [0,10,17,15,62,168,276][$passed_rank(pos, square)];\n  v += $passed_block(pos, square);\n  v -= 11 * $passed_file(pos, square);\n  return v;\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Passed eg","group":"Passed pawns","text":"<b>$</b> endgame bonuses for passed pawns. Scale down bonus for candidate passers which need more than one pawn push to become passed, or have a pawn in front of them.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (!$passed_leverable(pos, square)) return 0;\n  var v = 0;\n  v += $king_proximity(pos, square);\n  v += [0,28,33,41,72,177,260][$passed_rank(pos, square)];\n  v += $passed_block(pos, square);\n  v -= 8 * $passed_file(pos, square);\n  return v;\n}","links":[["https://en.wikipedia.org/wiki/Isolated_pawn","Isolated pawn"]],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Piece count","group":"Helpers","text":"<b>$</b> counts number of our pieces (including pawns and king).","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var i = \"PNBRQK\".indexOf(board(pos, square.x, square.y));\n  return i >= 0 ? 1 : 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Bishop xray pawns","group":"Pieces","text":"<b>$</b>. Penalty for all enemy pawns xrayed by our bishop.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\") return 0;\n  var count = 0;\n  for (var x = 0; x < 8; x++) {\n    for (var y = 0; y < 8; y++) {\n      if (board(pos, x, y) == \"p\"\n       && Math.abs(square.x-x) == Math.abs(square.y-y)) count++;\n    }\n  }\n  return count;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Rook on king ring","group":"Pieces","text":"<b>$</b>. Give bonus for rooks that are alligned with enemy kingring.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"R\") return 0;\n  if ($king_attackers_count(pos, square) > 0) return 0;\n  for (var y = 0; y < 8; y++) {\n    if ($king_ring(pos, {x:square.x, y:y})) return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Bishop on king ring","group":"Pieces","text":"<b>$</b>. Give bonus for bishops that are alligned with enemy kingring.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"B\") return 0;\n  if ($king_attackers_count(pos, square) > 0) return 0;\n  for (var i = 0; i < 4; i++) {\n    var ix = ((i > 1) * 2 - 1);\n    var iy = ((i % 2 == 0) * 2 - 1);\n    for (var d = 1; d < 8; d++) {\n      var x = square.x + d * ix, y = square.y + d * iy;\n      if (board(pos, x, y) == \"x\") break;\n      if ($king_ring(pos, {x:x, y:y})) return 1;\n      if (board(pos, x, y).toUpperCase() == \"P\") break;\n    }\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Queen infiltration","group":"Pieces","text":"<b>$</b>. Bonus for queen on weak square in enemy camp. Idea is that queen feels much better when it can't be kicked away now or later by pawn moves, especially in endgame.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"Q\") return 0;\n  if (square.y > 3) return 0;\n  if (board(pos, square.x + 1, square.y - 1) == \"p\") return 0;\n  if (board(pos, square.x - 1, square.y - 1) == \"p\") return 0;\n  if ($pawn_attacks_span(pos, square)) return 0;\n  return 1;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Pieces mg","group":"Pieces","text":"<b>$</b>. Middlegame bonuses and penalties to the pieces of a given color and type. Mobility not included here.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"NBRQ\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  var v = 0;\n  v += [0,31,-7,30,56][$outpost_total(pos, square)];\n  v += 18 * $minor_behind_pawn(pos, square);\n  v -= 3 * $bishop_pawns(pos, square);\n  v -= 4 * $bishop_xray_pawns(pos, square);\n  v += 6 * $rook_on_queen_file(pos, square);\n  v += 16 * $rook_on_king_ring(pos, square);\n  v += 24 * $bishop_on_king_ring(pos, square);\n  v += [0,19,48][$rook_on_file(pos, square)];\n  v -= $trapped_rook(pos, square) * 55 * (pos.c[0] || pos.c[1] ? 1 : 2);\n  v -= 56 * $weak_queen(pos, square);\n  v -= 2 * $queen_infiltration(pos, square);\n  v -= (board(pos, square.x, square.y) == \"N\" ? 8 : 6) * $king_protector(pos, square);\n  v += 45 * $long_diagonal_bishop(pos, square);\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Pieces eg","group":"Pieces","text":"<b>$</b>. Endgame bonuses and penalties to the pieces of a given color and type. Mobility not included here.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (\"NBRQ\".indexOf(board(pos, square.x, square.y)) < 0) return 0;\n  var v = 0;\n  v += [0,22,36,23,36][$outpost_total(pos, square)];\n  v += 3 * $minor_behind_pawn(pos, square);\n  v -= 7 * $bishop_pawns(pos, square);\n  v -= 5 * $bishop_xray_pawns(pos, square);\n  v += 11 * $rook_on_queen_file(pos, square);\n  v += [0,7,29][$rook_on_file(pos, square)];\n  v -= $trapped_rook(pos, square) * 13 * (pos.c[0] || pos.c[1] ? 1 : 2);\n  v -= 15 * $weak_queen(pos, square);\n  v += 14 * $queen_infiltration(pos, square);\n  v -= 9 * $king_protector(pos, square);\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Blocked","group":"Pawns","text":"<b>$</b>. Bonus for blocked pawns at 5th or 6th rank","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if (square.y != 2 && square.y != 3) return 0;\n  if (board(pos, square.x, square.y - 1) != \"p\") return 0;\n  return 4 - square.y;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Pawn attacks span","group":"Helpers","text":"<b>$</b> Compute additional span if pawn is not backward nor blocked","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var pos2 = colorflip(pos);\n  for (var y = 0; y < square.y; y++) {\n    if (board(pos, square.x - 1, y) == \"p\"\n     && (y == square.y - 1\n     || (board(pos, square.x - 1, y + 1) != \"P\" \n     && !$backward(pos2,{x:square.x-1,y:7-y})))) return 1;\n    if (board(pos, square.x + 1, y) == \"p\"\n     && (y == square.y - 1\n     || (board(pos, square.x + 1, y + 1) != \"P\"\n      && !$backward(pos2,{x:square.x+1,y:7-y})))) return 1;\n  }\n  return 0;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Doubled isolated","group":"Pawns","text":"<b>$</b> is penalty if a doubled isolated pawn is stopped\nonly by a single opponent pawn on the same file.\n","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  if (board(pos, square.x, square.y) != \"P\") return 0;\n  if ($isolated(pos, square)) {\n    var obe=0,eop=0,ene=0;\n    for (var y = 0; y < 8; y++) {\n      if (y > square.y && board(pos, square.x, y) == \"P\") obe++;\n      if (y < square.y && board(pos, square.x, y) == \"p\") eop++;\n      if (board(pos, square.x - 1, y) == \"p\"\n       || board(pos, square.x + 1, y) == \"p\") ene++;\n    }\n    if (obe > 0 && ene == 0 && eop > 0) return 1;\n  }\n  return 0;\n\n}","links":[["https://en.wikipedia.org/wiki/Doubled_pawn","Doubled pawn"]],"eval":true,"squares":0,"highlight":2,"forwhite":true,"graph":true,"elo":null});
data.push({"name":"Pawns mg","group":"Pawns","text":"<b>$</b> is middlegame evaluation for pawns.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  if ($doubled_isolated(pos, square)) v -= 11;\n  else if ($isolated(pos, square)) v -= 5;\n  else if ($backward(pos, square)) v -= 9;\n  v -= $doubled(pos, square) * 11;\n  v += $connected(pos, square) ?  $connected_bonus(pos, square) : 0;\n  v -= 13 * $weak_unopposed_pawn(pos, square);\n  v += [0,-11,-3][$blocked(pos, square)];\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
data.push({"name":"Pawns eg","group":"Pawns","text":"<b>$</b> is endgame evaluation for pawns.","code":"function $$(pos, square) {\n  if (square == null) return sum(pos, $$);\n  var v = 0;\n  if ($doubled_isolated(pos, square)) v -= 56;\n  else if ($isolated(pos, square)) v -= 15;\n  else if ($backward(pos, square)) v -= 24;\n  v -= $doubled(pos, square) * 56;\n  v += $connected(pos, square) ?  $connected_bonus(pos, square) * ($rank(pos, square) - 3) / 4 << 0 : 0;\n  v -= 27 * $weak_unopposed_pawn(pos, square);\n  v -= 56 * $weak_lever(pos, square);\n  v += [0,-4,4][$blocked(pos, square)];\n  return v;\n}","links":[],"eval":true,"squares":1,"highlight":2,"forwhite":true,"graph":false,"elo":null});
</script> 

</body></html>